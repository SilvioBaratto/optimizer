"""extract_baml_nested_fields_to_dedicated_columns

Revision ID: 9e58a2966324
Revises: 5694c7ec300c
Create Date: 2025-10-13 16:24:16.132106

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision: str = '9e58a2966324'
down_revision: Union[str, Sequence[str], None] = '5694c7ec300c'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.add_column('baml_analyses', sa.Column('confidence_adjustment', sa.Float(), nullable=True, comment='Confidence adjustment from news (-1.0 to 1.0)'))
    op.add_column('baml_analyses', sa.Column('adjusted_confidence', sa.Float(), nullable=True, comment='Final adjusted confidence after news analysis (0.0 to 1.0)'))
    op.add_column('baml_analyses', sa.Column('enhanced_rationale', sa.Text(), nullable=True, comment='Enhanced rationale incorporating news analysis'))
    op.add_column('baml_analyses', sa.Column('news_sentiment', sa.String(length=100), nullable=True, comment="Overall news sentiment (e.g., 'cautiously_optimistic', 'bearish')"))
    op.add_column('baml_analyses', sa.Column('contradiction_warning', sa.Text(), nullable=True, comment='Warning if news contradicts quantitative signals'))
    op.add_column('baml_analyses', sa.Column('risk_adjustment_6m', sa.Float(), nullable=True, comment='6-month recession risk adjustment from news'))
    op.add_column('baml_analyses', sa.Column('risk_adjustment_12m', sa.Float(), nullable=True, comment='12-month recession risk adjustment from news'))
    op.add_column('baml_analyses', sa.Column('adjusted_risk_6m', sa.Float(), nullable=True, comment='Final adjusted 6-month recession risk (0.0 to 1.0)'))
    op.add_column('baml_analyses', sa.Column('adjusted_risk_12m', sa.Float(), nullable=True, comment='Final adjusted 12-month recession risk (0.0 to 1.0)'))
    op.add_column('baml_analyses', sa.Column('warning_signs', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='List of recession warning signs from news'))
    op.add_column('baml_analyses', sa.Column('leading_indicators', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='List of leading economic indicators from news'))
    op.add_column('baml_analyses', sa.Column('transition_likelihood', sa.Float(), nullable=True, comment='Likelihood of regime transition (0.0 to 1.0)'))
    op.add_column('baml_analyses', sa.Column('potential_next_regime', sa.String(length=50), nullable=True, comment='Most likely next regime if transition occurs'))
    op.add_column('baml_analyses', sa.Column('narrative_shift', sa.String(length=50), nullable=True, comment="Narrative shift status: 'emerging', 'stable', 'accelerating'"))
    op.add_column('baml_analyses', sa.Column('narrative_themes', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='List of dominant narrative themes in news'))
    op.add_column('baml_analyses', sa.Column('estimated_timeframe', sa.String(length=100), nullable=True, comment="Estimated timeframe for potential transition (e.g., '3-6 months')"))
    op.add_column('baml_analyses', sa.Column('transition_signals_list', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='List of specific transition signals detected'))
    op.add_column('baml_analyses', sa.Column('sector_adjustments', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment="Sector weight adjustments from news (e.g., {'Technology': 0.02})"))
    op.add_column('baml_analyses', sa.Column('leading_sectors', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='List of leading sectors based on news sentiment'))
    op.add_column('baml_analyses', sa.Column('lagging_sectors', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='List of lagging sectors based on news sentiment'))
    op.add_column('baml_analyses', sa.Column('sector_drivers', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment="Sector-specific news drivers (e.g., {'Technology': 'AI boom...'})"))
    op.drop_column('baml_analyses', 'regime_analysis')
    op.drop_column('baml_analyses', 'sector_insights')
    op.drop_column('baml_analyses', 'transition_signals')
    op.drop_column('baml_analyses', 'recession_risk_analysis')
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.add_column('baml_analyses', sa.Column('recession_risk_analysis', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True, comment='Output from CalculateRecessionRiskFromNews'))
    op.add_column('baml_analyses', sa.Column('transition_signals', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True, comment='Output from DetectRegimeTransition'))
    op.add_column('baml_analyses', sa.Column('sector_insights', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True, comment='Output from AnalyzeSectorSignals'))
    op.add_column('baml_analyses', sa.Column('regime_analysis', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True, comment='Output from AnalyzeMacroRegimeWithNews'))
    op.drop_column('baml_analyses', 'sector_drivers')
    op.drop_column('baml_analyses', 'lagging_sectors')
    op.drop_column('baml_analyses', 'leading_sectors')
    op.drop_column('baml_analyses', 'sector_adjustments')
    op.drop_column('baml_analyses', 'transition_signals_list')
    op.drop_column('baml_analyses', 'estimated_timeframe')
    op.drop_column('baml_analyses', 'narrative_themes')
    op.drop_column('baml_analyses', 'narrative_shift')
    op.drop_column('baml_analyses', 'potential_next_regime')
    op.drop_column('baml_analyses', 'transition_likelihood')
    op.drop_column('baml_analyses', 'leading_indicators')
    op.drop_column('baml_analyses', 'warning_signs')
    op.drop_column('baml_analyses', 'adjusted_risk_12m')
    op.drop_column('baml_analyses', 'adjusted_risk_6m')
    op.drop_column('baml_analyses', 'risk_adjustment_12m')
    op.drop_column('baml_analyses', 'risk_adjustment_6m')
    op.drop_column('baml_analyses', 'contradiction_warning')
    op.drop_column('baml_analyses', 'news_sentiment')
    op.drop_column('baml_analyses', 'enhanced_rationale')
    op.drop_column('baml_analyses', 'adjusted_confidence')
    op.drop_column('baml_analyses', 'confidence_adjustment')
    # ### end Alembic commands ###
