"""Add missing fields for BAML pure LLM output

Revision ID: 7e79eee5aad3
Revises: ad5680513f25
Create Date: 2025-10-14 13:10:07.713291

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision: str = '7e79eee5aad3'
down_revision: Union[str, Sequence[str], None] = 'ad5680513f25'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.add_column('baml_analyses', sa.Column('recession_rationale', sa.Text(), nullable=True, comment='Detailed rationale for recession risk assessment'))
    op.add_column('baml_analyses', sa.Column('economic_momentum_assessment', sa.Text(), nullable=True, comment='AI-generated assessment of economic momentum'))
    op.add_column('baml_analyses', sa.Column('market_conditions_assessment', sa.Text(), nullable=True, comment='AI-generated assessment of market conditions'))
    op.add_column('baml_analyses', sa.Column('classification_confidence_breakdown', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='Detailed breakdown of confidence scores by category'))
    op.add_column('baml_analyses', sa.Column('data_completeness', sa.String(length=50), nullable=True, comment="Assessment of data completeness (e.g., 'complete', 'partial')"))
    op.add_column('baml_analyses', sa.Column('missing_critical_data', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='List of missing critical data points'))
    op.alter_column('baml_analyses', 'analysis_timestamp',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment='When BAML analysis was performed',
               existing_nullable=False)
    op.alter_column('baml_analyses', 'confidence_adjustment',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='Confidence adjustment from news (-1.0 to 1.0)',
               existing_nullable=True)
    op.alter_column('baml_analyses', 'adjusted_confidence',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='Final adjusted confidence after news analysis (0.0 to 1.0)',
               existing_nullable=True)
    op.alter_column('baml_analyses', 'enhanced_rationale',
               existing_type=sa.TEXT(),
               comment='Enhanced rationale incorporating news analysis',
               existing_nullable=True)
    op.alter_column('baml_analyses', 'news_sentiment',
               existing_type=sa.VARCHAR(length=1000),
               comment="Overall news sentiment (e.g., 'cautiously_optimistic', 'bearish')",
               existing_nullable=True)
    op.alter_column('baml_analyses', 'contradiction_warning',
               existing_type=sa.VARCHAR(length=2000),
               comment='Warning if news contradicts quantitative signals',
               existing_nullable=True)
    op.alter_column('baml_analyses', 'risk_adjustment_6m',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='6-month recession risk adjustment from news',
               existing_nullable=True)
    op.alter_column('baml_analyses', 'risk_adjustment_12m',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='12-month recession risk adjustment from news',
               existing_nullable=True)
    op.alter_column('baml_analyses', 'adjusted_risk_6m',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='Final adjusted 6-month recession risk (0.0 to 1.0)',
               existing_nullable=True)
    op.alter_column('baml_analyses', 'adjusted_risk_12m',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='Final adjusted 12-month recession risk (0.0 to 1.0)',
               existing_nullable=True)
    op.alter_column('baml_analyses', 'warning_signs',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment='List of recession warning signs from news',
               existing_nullable=True)
    op.alter_column('baml_analyses', 'leading_indicators',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment='List of leading economic indicators from news',
               existing_nullable=True)
    op.alter_column('baml_analyses', 'transition_likelihood',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='Likelihood of regime transition (0.0 to 1.0)',
               existing_nullable=True)
    op.alter_column('baml_analyses', 'potential_next_regime',
               existing_type=sa.VARCHAR(length=50),
               comment='Most likely next regime if transition occurs',
               existing_nullable=True)
    op.alter_column('baml_analyses', 'narrative_shift',
               existing_type=sa.VARCHAR(length=50),
               comment="Narrative shift status: 'emerging', 'stable', 'accelerating'",
               existing_nullable=True)
    op.alter_column('baml_analyses', 'narrative_themes',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment='List of dominant narrative themes in news',
               existing_nullable=True)
    op.alter_column('baml_analyses', 'estimated_timeframe',
               existing_type=sa.VARCHAR(length=100),
               comment="Estimated timeframe for potential transition (e.g., '3-6 months')",
               existing_nullable=True)
    op.alter_column('baml_analyses', 'transition_signals_list',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment='List of specific transition signals detected',
               existing_nullable=True)
    op.alter_column('baml_analyses', 'sector_adjustments',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment="Sector weight adjustments from news (e.g., {'Technology': 0.02})",
               existing_nullable=True)
    op.alter_column('baml_analyses', 'leading_sectors',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment='List of leading sectors based on news sentiment',
               existing_nullable=True)
    op.alter_column('baml_analyses', 'lagging_sectors',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment='List of lagging sectors based on news sentiment',
               existing_nullable=True)
    op.alter_column('baml_analyses', 'sector_drivers',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment="Sector-specific news drivers (e.g., {'Technology': 'AI boom...'})",
               existing_nullable=True)
    op.create_index('idx_baml_conf_breakdown_gin', 'baml_analyses', ['classification_confidence_breakdown'], unique=False, postgresql_using='gin')
    op.create_index('idx_baml_missing_data_gin', 'baml_analyses', ['missing_critical_data'], unique=False, postgresql_using='gin')
    op.create_index(op.f('ix_baml_analyses_analysis_timestamp'), 'baml_analyses', ['analysis_timestamp'], unique=False)
    op.add_column('country_regime_assessments', sa.Column('potential_next_regime', sa.Enum('EARLY_CYCLE', 'MID_CYCLE', 'LATE_CYCLE', 'RECESSION', 'UNCERTAIN', name='regimeenum', native_enum=False, length=30), nullable=True, comment='Most likely next regime if transition occurs'))
    op.add_column('country_regime_assessments', sa.Column('transition_timeframe', sa.String(length=100), nullable=True, comment="Estimated timeframe for potential transition (e.g., '3-6 months')"))
    op.add_column('country_regime_assessments', sa.Column('recession_rationale', sa.Text(), nullable=True, comment='Detailed rationale for recession risk assessment'))
    op.add_column('country_regime_assessments', sa.Column('economic_momentum_assessment', sa.Text(), nullable=True, comment='AI-generated assessment of economic momentum'))
    op.add_column('country_regime_assessments', sa.Column('market_conditions_assessment', sa.Text(), nullable=True, comment='AI-generated assessment of market conditions'))
    op.add_column('country_regime_assessments', sa.Column('classification_confidence_breakdown', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='Detailed breakdown of confidence scores by category'))
    op.add_column('country_regime_assessments', sa.Column('key_risks', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='List of key risks identified in the analysis'))
    op.add_column('country_regime_assessments', sa.Column('data_completeness', sa.String(length=50), nullable=True, comment="Assessment of data completeness (e.g., 'complete', 'partial')"))
    op.add_column('country_regime_assessments', sa.Column('missing_critical_data', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='List of missing critical data points'))
    op.alter_column('country_regime_assessments', 'analysis_run_id',
               existing_type=sa.UUID(),
               comment='Reference to parent analysis run',
               existing_nullable=False)
    op.alter_column('country_regime_assessments', 'economic_indicators_id',
               existing_type=sa.UUID(),
               comment='Reference to country economic indicators',
               existing_nullable=False)
    op.alter_column('country_regime_assessments', 'baml_analysis_id',
               existing_type=sa.UUID(),
               comment='Reference to BAML analysis (if news-enhanced)',
               existing_nullable=True)
    op.alter_column('country_regime_assessments', 'country',
               existing_type=sa.VARCHAR(length=50),
               comment="Country code (e.g., 'USA', 'Germany')",
               existing_nullable=False)
    op.alter_column('country_regime_assessments', 'assessment_timestamp',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment='When the assessment was made',
               existing_nullable=False)
    op.alter_column('country_regime_assessments', 'regime',
               existing_type=sa.VARCHAR(length=30),
               comment="Regime: 'early_cycle', 'mid_cycle', 'late_cycle', 'recession', 'uncertain'",
               existing_nullable=False)
    op.alter_column('country_regime_assessments', 'confidence',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='Confidence in regime classification (0.0-1.0)',
               existing_nullable=False)
    op.alter_column('country_regime_assessments', 'transition_probability',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='Probability of regime transition in next 6 months (0.0-1.0)',
               existing_nullable=False)
    op.alter_column('country_regime_assessments', 'rationale',
               existing_type=sa.TEXT(),
               comment='Human-readable rationale for regime classification',
               existing_nullable=False)
    op.alter_column('country_regime_assessments', 'gdp_momentum',
               existing_type=sa.VARCHAR(length=50),
               comment="GDP momentum signal: 'strong', 'moderate', 'weak', 'contracting'",
               existing_nullable=True)
    op.alter_column('country_regime_assessments', 'inflation_momentum',
               existing_type=sa.VARCHAR(length=50),
               comment="Inflation momentum signal: 'accelerating', 'stable', 'subdued', 'falling'",
               existing_nullable=True)
    op.alter_column('country_regime_assessments', 'recession_risk_6m',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='6-month recession risk (0.0-1.0)',
               existing_nullable=True)
    op.alter_column('country_regime_assessments', 'recession_risk_12m',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='12-month recession risk (0.0-1.0)',
               existing_nullable=True)
    op.alter_column('country_regime_assessments', 'sector_tilts',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment="Sector overweight/underweight recommendations (e.g., {'Technology': 0.03})",
               existing_nullable=False)
    op.alter_column('country_regime_assessments', 'factor_timing',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment="Factor timing recommendations (e.g., {'Value': 'overweight'})",
               existing_nullable=False)
    op.alter_column('country_regime_assessments', 'news_enhanced',
               existing_type=sa.BOOLEAN(),
               comment='Whether this assessment was enhanced with news analysis',
               existing_nullable=False)
    op.create_index('idx_assessment_conf_breakdown_gin', 'country_regime_assessments', ['classification_confidence_breakdown'], unique=False, postgresql_using='gin')
    op.create_index('idx_assessment_key_risks_gin', 'country_regime_assessments', ['key_risks'], unique=False, postgresql_using='gin')
    op.create_index('idx_assessment_missing_data_gin', 'country_regime_assessments', ['missing_critical_data'], unique=False, postgresql_using='gin')
    op.create_index('idx_assessment_next_regime', 'country_regime_assessments', ['potential_next_regime'], unique=False)
    op.create_index(op.f('ix_country_regime_assessments_analysis_run_id'), 'country_regime_assessments', ['analysis_run_id'], unique=False)
    op.create_index(op.f('ix_country_regime_assessments_assessment_timestamp'), 'country_regime_assessments', ['assessment_timestamp'], unique=False)
    op.create_index(op.f('ix_country_regime_assessments_baml_analysis_id'), 'country_regime_assessments', ['baml_analysis_id'], unique=False)
    op.create_index(op.f('ix_country_regime_assessments_country'), 'country_regime_assessments', ['country'], unique=False)
    op.create_index(op.f('ix_country_regime_assessments_economic_indicators_id'), 'country_regime_assessments', ['economic_indicators_id'], unique=False)
    op.create_index(op.f('ix_country_regime_assessments_regime'), 'country_regime_assessments', ['regime'], unique=False)
    op.alter_column('economic_indicators', 'country',
               existing_type=sa.VARCHAR(length=50),
               comment="Country code (e.g., 'USA', 'Germany')",
               existing_nullable=False)
    op.alter_column('economic_indicators', 'data_timestamp',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment='When the indicator data was fetched',
               existing_nullable=False)
    op.alter_column('economic_indicators', 'gdp_growth_qq',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='GDP growth quarter-over-quarter (%)',
               existing_nullable=True)
    op.alter_column('economic_indicators', 'gdp_growth_yy',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='GDP growth year-over-year (%)',
               existing_nullable=True)
    op.alter_column('economic_indicators', 'unemployment',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='Unemployment rate (%)',
               existing_nullable=True)
    op.alter_column('economic_indicators', 'inflation',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='Inflation rate (%)',
               existing_nullable=True)
    op.alter_column('economic_indicators', 'industrial_production',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='Industrial production growth (%)',
               existing_nullable=True)
    op.alter_column('economic_indicators', 'retail_sales',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='Retail sales growth (%)',
               existing_nullable=True)
    op.alter_column('economic_indicators', 'consumer_prices',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='Consumer prices / CPI (%)',
               existing_nullable=True)
    op.alter_column('economic_indicators', 'deficit',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='Government deficit as % of GDP',
               existing_nullable=True)
    op.alter_column('economic_indicators', 'debt',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='Government debt as % of GDP',
               existing_nullable=True)
    op.alter_column('economic_indicators', 'st_rate',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='Short-term interest rate (%)',
               existing_nullable=True)
    op.alter_column('economic_indicators', 'lt_rate',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='Long-term interest rate (%)',
               existing_nullable=True)
    op.alter_column('economic_indicators', 'gdp_forecast_6m',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='GDP growth forecast 6-month (%)',
               existing_nullable=True)
    op.alter_column('economic_indicators', 'inflation_forecast_6m',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='Inflation forecast 6-month (%)',
               existing_nullable=True)
    op.alter_column('economic_indicators', 'earnings_forecast_12m',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='Corporate earnings growth forecast 12-month (%)',
               existing_nullable=True)
    op.alter_column('economic_indicators', 'status',
               existing_type=sa.VARCHAR(length=20),
               comment="Data status: 'complete', 'cached', 'error'",
               existing_nullable=False)
    op.create_index(op.f('ix_economic_indicators_country'), 'economic_indicators', ['country'], unique=False)
    op.create_index(op.f('ix_economic_indicators_data_timestamp'), 'economic_indicators', ['data_timestamp'], unique=False)
    op.alter_column('macro_analysis_runs', 'run_timestamp',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment='When the analysis was executed',
               existing_nullable=False)
    op.alter_column('macro_analysis_runs', 'analysis_type',
               existing_type=sa.VARCHAR(length=50),
               comment="Analysis type: 'news_enhanced' or 'quantitative_only'",
               existing_nullable=False)
    op.alter_column('macro_analysis_runs', 'full_content_fetched',
               existing_type=sa.BOOLEAN(),
               comment='Whether full article content was fetched',
               existing_nullable=False)
    op.alter_column('macro_analysis_runs', 'num_countries',
               existing_type=sa.INTEGER(),
               comment='Number of countries analyzed in this run',
               existing_nullable=False)
    op.alter_column('macro_analysis_runs', 'countries',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment="List of country codes analyzed (e.g., ['USA', 'Germany'])",
               existing_nullable=False)
    op.alter_column('macro_analysis_runs', 'notes',
               existing_type=sa.TEXT(),
               comment='Optional notes about this analysis run',
               existing_nullable=True)
    op.create_index(op.f('ix_macro_analysis_runs_run_timestamp'), 'macro_analysis_runs', ['run_timestamp'], unique=False)
    op.alter_column('market_indicators', 'analysis_run_id',
               existing_type=sa.UUID(),
               comment='Reference to parent analysis run',
               existing_nullable=False)
    op.alter_column('market_indicators', 'data_timestamp',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment='When the indicator data was fetched',
               existing_nullable=False)
    op.alter_column('market_indicators', 'ism_pmi',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='ISM Manufacturing PMI',
               existing_nullable=True)
    op.alter_column('market_indicators', 'yield_curve_2s10s',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='2s10s yield curve spread (basis points)',
               existing_nullable=True)
    op.alter_column('market_indicators', 'hy_spread',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='High-yield credit spread (basis points)',
               existing_nullable=True)
    op.alter_column('market_indicators', 'ig_spread',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='Investment-grade credit spread (basis points)',
               existing_nullable=True)
    op.alter_column('market_indicators', 'vix',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='VIX volatility index',
               existing_nullable=True)
    op.alter_column('market_indicators', 'vix_signal',
               existing_type=sa.VARCHAR(length=20),
               comment="VIX regime: 'LOW_VOL', 'MEDIUM_VOL', 'HIGH_VOL', 'elevated'",
               existing_nullable=True)
    op.alter_column('market_indicators', 'ism_signal',
               existing_type=sa.VARCHAR(length=20),
               comment="ISM signal: 'expansion', 'neutral', 'contraction'",
               existing_nullable=True)
    op.alter_column('market_indicators', 'curve_signal',
               existing_type=sa.VARCHAR(length=20),
               comment="Yield curve signal: 'steep', 'normal', 'flat', 'inverted'",
               existing_nullable=True)
    op.alter_column('market_indicators', 'credit_signal',
               existing_type=sa.VARCHAR(length=20),
               comment="Credit spread signal: 'risk_on', 'neutral', 'elevated', 'distress'",
               existing_nullable=True)
    op.alter_column('market_indicators', 'data_quality',
               existing_type=sa.VARCHAR(length=20),
               comment="Data quality: 'complete', 'partial', 'incomplete', 'excellent'",
               existing_nullable=False)
    op.create_index(op.f('ix_market_indicators_analysis_run_id'), 'market_indicators', ['analysis_run_id'], unique=False)
    op.create_index(op.f('ix_market_indicators_data_timestamp'), 'market_indicators', ['data_timestamp'], unique=False)
    op.add_column('news_articles', sa.Column('ticker_source', sa.String(length=50), nullable=True, comment='Ticker or source identifier for the article'))
    op.add_column('news_articles', sa.Column('content_length', sa.Integer(), nullable=True, comment='Length of article content in characters'))
    op.alter_column('news_articles', 'assessment_id',
               existing_type=sa.UUID(),
               comment='Reference to parent regime assessment',
               existing_nullable=False)
    op.alter_column('news_articles', 'title',
               existing_type=sa.TEXT(),
               comment='Article title',
               existing_nullable=False)
    op.alter_column('news_articles', 'publisher',
               existing_type=sa.VARCHAR(length=255),
               comment='Publisher/source name',
               existing_nullable=True)
    op.alter_column('news_articles', 'published_date',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment='When the article was published',
               existing_nullable=True)
    op.alter_column('news_articles', 'link',
               existing_type=sa.TEXT(),
               comment='URL to original article',
               existing_nullable=True)
    op.alter_column('news_articles', 'full_content',
               existing_type=sa.TEXT(),
               comment='Full article text content',
               existing_nullable=True)
    op.alter_column('news_articles', 'is_macro_relevant',
               existing_type=sa.BOOLEAN(),
               comment='Whether article passed macro keyword filter',
               existing_nullable=False)
    op.create_index(op.f('ix_news_articles_assessment_id'), 'news_articles', ['assessment_id'], unique=False)
    op.create_index(op.f('ix_news_articles_published_date'), 'news_articles', ['published_date'], unique=False)
    op.alter_column('regime_transitions', 'assessment_id',
               existing_type=sa.UUID(),
               comment='Reference to assessment where transition occurred',
               existing_nullable=False)
    op.alter_column('regime_transitions', 'country',
               existing_type=sa.VARCHAR(length=50),
               comment='Country code',
               existing_nullable=False)
    op.alter_column('regime_transitions', 'transition_date',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment='When the transition was detected',
               existing_nullable=False)
    op.alter_column('regime_transitions', 'from_regime',
               existing_type=sa.VARCHAR(length=30),
               comment='Previous regime',
               existing_nullable=False)
    op.alter_column('regime_transitions', 'to_regime',
               existing_type=sa.VARCHAR(length=30),
               comment='New regime',
               existing_nullable=False)
    op.alter_column('regime_transitions', 'confidence',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='Confidence in transition (0.0-1.0)',
               existing_nullable=False)
    op.alter_column('regime_transitions', 'alert_level',
               existing_type=sa.VARCHAR(length=20),
               comment="'LOW', 'MEDIUM', 'HIGH' based on confidence",
               existing_nullable=False)
    op.alter_column('regime_transitions', 'days_since_last_transition',
               existing_type=sa.INTEGER(),
               comment='Days since previous transition',
               existing_nullable=True)
    op.create_index(op.f('ix_regime_transitions_assessment_id'), 'regime_transitions', ['assessment_id'], unique=False)
    op.create_index(op.f('ix_regime_transitions_country'), 'regime_transitions', ['country'], unique=False)
    op.create_index(op.f('ix_regime_transitions_transition_date'), 'regime_transitions', ['transition_date'], unique=False)
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(op.f('ix_regime_transitions_transition_date'), table_name='regime_transitions')
    op.drop_index(op.f('ix_regime_transitions_country'), table_name='regime_transitions')
    op.drop_index(op.f('ix_regime_transitions_assessment_id'), table_name='regime_transitions')
    op.alter_column('regime_transitions', 'days_since_last_transition',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Days since previous transition',
               existing_nullable=True)
    op.alter_column('regime_transitions', 'alert_level',
               existing_type=sa.VARCHAR(length=20),
               comment=None,
               existing_comment="'LOW', 'MEDIUM', 'HIGH' based on confidence",
               existing_nullable=False)
    op.alter_column('regime_transitions', 'confidence',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='Confidence in transition (0.0-1.0)',
               existing_nullable=False)
    op.alter_column('regime_transitions', 'to_regime',
               existing_type=sa.VARCHAR(length=30),
               comment=None,
               existing_comment='New regime',
               existing_nullable=False)
    op.alter_column('regime_transitions', 'from_regime',
               existing_type=sa.VARCHAR(length=30),
               comment=None,
               existing_comment='Previous regime',
               existing_nullable=False)
    op.alter_column('regime_transitions', 'transition_date',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment=None,
               existing_comment='When the transition was detected',
               existing_nullable=False)
    op.alter_column('regime_transitions', 'country',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment='Country code',
               existing_nullable=False)
    op.alter_column('regime_transitions', 'assessment_id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='Reference to assessment where transition occurred',
               existing_nullable=False)
    op.drop_index(op.f('ix_news_articles_published_date'), table_name='news_articles')
    op.drop_index(op.f('ix_news_articles_assessment_id'), table_name='news_articles')
    op.alter_column('news_articles', 'is_macro_relevant',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='Whether article passed macro keyword filter',
               existing_nullable=False)
    op.alter_column('news_articles', 'full_content',
               existing_type=sa.TEXT(),
               comment=None,
               existing_comment='Full article text content',
               existing_nullable=True)
    op.alter_column('news_articles', 'link',
               existing_type=sa.TEXT(),
               comment=None,
               existing_comment='URL to original article',
               existing_nullable=True)
    op.alter_column('news_articles', 'published_date',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment=None,
               existing_comment='When the article was published',
               existing_nullable=True)
    op.alter_column('news_articles', 'publisher',
               existing_type=sa.VARCHAR(length=255),
               comment=None,
               existing_comment='Publisher/source name',
               existing_nullable=True)
    op.alter_column('news_articles', 'title',
               existing_type=sa.TEXT(),
               comment=None,
               existing_comment='Article title',
               existing_nullable=False)
    op.alter_column('news_articles', 'assessment_id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='Reference to parent regime assessment',
               existing_nullable=False)
    op.drop_column('news_articles', 'content_length')
    op.drop_column('news_articles', 'ticker_source')
    op.drop_index(op.f('ix_market_indicators_data_timestamp'), table_name='market_indicators')
    op.drop_index(op.f('ix_market_indicators_analysis_run_id'), table_name='market_indicators')
    op.alter_column('market_indicators', 'data_quality',
               existing_type=sa.VARCHAR(length=20),
               comment=None,
               existing_comment="Data quality: 'complete', 'partial', 'incomplete', 'excellent'",
               existing_nullable=False)
    op.alter_column('market_indicators', 'credit_signal',
               existing_type=sa.VARCHAR(length=20),
               comment=None,
               existing_comment="Credit spread signal: 'risk_on', 'neutral', 'elevated', 'distress'",
               existing_nullable=True)
    op.alter_column('market_indicators', 'curve_signal',
               existing_type=sa.VARCHAR(length=20),
               comment=None,
               existing_comment="Yield curve signal: 'steep', 'normal', 'flat', 'inverted'",
               existing_nullable=True)
    op.alter_column('market_indicators', 'ism_signal',
               existing_type=sa.VARCHAR(length=20),
               comment=None,
               existing_comment="ISM signal: 'expansion', 'neutral', 'contraction'",
               existing_nullable=True)
    op.alter_column('market_indicators', 'vix_signal',
               existing_type=sa.VARCHAR(length=20),
               comment=None,
               existing_comment="VIX regime: 'LOW_VOL', 'MEDIUM_VOL', 'HIGH_VOL', 'elevated'",
               existing_nullable=True)
    op.alter_column('market_indicators', 'vix',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='VIX volatility index',
               existing_nullable=True)
    op.alter_column('market_indicators', 'ig_spread',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='Investment-grade credit spread (basis points)',
               existing_nullable=True)
    op.alter_column('market_indicators', 'hy_spread',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='High-yield credit spread (basis points)',
               existing_nullable=True)
    op.alter_column('market_indicators', 'yield_curve_2s10s',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='2s10s yield curve spread (basis points)',
               existing_nullable=True)
    op.alter_column('market_indicators', 'ism_pmi',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='ISM Manufacturing PMI',
               existing_nullable=True)
    op.alter_column('market_indicators', 'data_timestamp',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment=None,
               existing_comment='When the indicator data was fetched',
               existing_nullable=False)
    op.alter_column('market_indicators', 'analysis_run_id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='Reference to parent analysis run',
               existing_nullable=False)
    op.drop_index(op.f('ix_macro_analysis_runs_run_timestamp'), table_name='macro_analysis_runs')
    op.alter_column('macro_analysis_runs', 'notes',
               existing_type=sa.TEXT(),
               comment=None,
               existing_comment='Optional notes about this analysis run',
               existing_nullable=True)
    op.alter_column('macro_analysis_runs', 'countries',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment=None,
               existing_comment="List of country codes analyzed (e.g., ['USA', 'Germany'])",
               existing_nullable=False)
    op.alter_column('macro_analysis_runs', 'num_countries',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='Number of countries analyzed in this run',
               existing_nullable=False)
    op.alter_column('macro_analysis_runs', 'full_content_fetched',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='Whether full article content was fetched',
               existing_nullable=False)
    op.alter_column('macro_analysis_runs', 'analysis_type',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment="Analysis type: 'news_enhanced' or 'quantitative_only'",
               existing_nullable=False)
    op.alter_column('macro_analysis_runs', 'run_timestamp',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment=None,
               existing_comment='When the analysis was executed',
               existing_nullable=False)
    op.drop_index(op.f('ix_economic_indicators_data_timestamp'), table_name='economic_indicators')
    op.drop_index(op.f('ix_economic_indicators_country'), table_name='economic_indicators')
    op.alter_column('economic_indicators', 'status',
               existing_type=sa.VARCHAR(length=20),
               comment=None,
               existing_comment="Data status: 'complete', 'cached', 'error'",
               existing_nullable=False)
    op.alter_column('economic_indicators', 'earnings_forecast_12m',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='Corporate earnings growth forecast 12-month (%)',
               existing_nullable=True)
    op.alter_column('economic_indicators', 'inflation_forecast_6m',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='Inflation forecast 6-month (%)',
               existing_nullable=True)
    op.alter_column('economic_indicators', 'gdp_forecast_6m',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='GDP growth forecast 6-month (%)',
               existing_nullable=True)
    op.alter_column('economic_indicators', 'lt_rate',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='Long-term interest rate (%)',
               existing_nullable=True)
    op.alter_column('economic_indicators', 'st_rate',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='Short-term interest rate (%)',
               existing_nullable=True)
    op.alter_column('economic_indicators', 'debt',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='Government debt as % of GDP',
               existing_nullable=True)
    op.alter_column('economic_indicators', 'deficit',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='Government deficit as % of GDP',
               existing_nullable=True)
    op.alter_column('economic_indicators', 'consumer_prices',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='Consumer prices / CPI (%)',
               existing_nullable=True)
    op.alter_column('economic_indicators', 'retail_sales',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='Retail sales growth (%)',
               existing_nullable=True)
    op.alter_column('economic_indicators', 'industrial_production',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='Industrial production growth (%)',
               existing_nullable=True)
    op.alter_column('economic_indicators', 'inflation',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='Inflation rate (%)',
               existing_nullable=True)
    op.alter_column('economic_indicators', 'unemployment',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='Unemployment rate (%)',
               existing_nullable=True)
    op.alter_column('economic_indicators', 'gdp_growth_yy',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='GDP growth year-over-year (%)',
               existing_nullable=True)
    op.alter_column('economic_indicators', 'gdp_growth_qq',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='GDP growth quarter-over-quarter (%)',
               existing_nullable=True)
    op.alter_column('economic_indicators', 'data_timestamp',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment=None,
               existing_comment='When the indicator data was fetched',
               existing_nullable=False)
    op.alter_column('economic_indicators', 'country',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment="Country code (e.g., 'USA', 'Germany')",
               existing_nullable=False)
    op.drop_index(op.f('ix_country_regime_assessments_regime'), table_name='country_regime_assessments')
    op.drop_index(op.f('ix_country_regime_assessments_economic_indicators_id'), table_name='country_regime_assessments')
    op.drop_index(op.f('ix_country_regime_assessments_country'), table_name='country_regime_assessments')
    op.drop_index(op.f('ix_country_regime_assessments_baml_analysis_id'), table_name='country_regime_assessments')
    op.drop_index(op.f('ix_country_regime_assessments_assessment_timestamp'), table_name='country_regime_assessments')
    op.drop_index(op.f('ix_country_regime_assessments_analysis_run_id'), table_name='country_regime_assessments')
    op.drop_index('idx_assessment_next_regime', table_name='country_regime_assessments')
    op.drop_index('idx_assessment_missing_data_gin', table_name='country_regime_assessments', postgresql_using='gin')
    op.drop_index('idx_assessment_key_risks_gin', table_name='country_regime_assessments', postgresql_using='gin')
    op.drop_index('idx_assessment_conf_breakdown_gin', table_name='country_regime_assessments', postgresql_using='gin')
    op.alter_column('country_regime_assessments', 'news_enhanced',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='Whether this assessment was enhanced with news analysis',
               existing_nullable=False)
    op.alter_column('country_regime_assessments', 'factor_timing',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment=None,
               existing_comment="Factor timing recommendations (e.g., {'Value': 'overweight'})",
               existing_nullable=False)
    op.alter_column('country_regime_assessments', 'sector_tilts',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment=None,
               existing_comment="Sector overweight/underweight recommendations (e.g., {'Technology': 0.03})",
               existing_nullable=False)
    op.alter_column('country_regime_assessments', 'recession_risk_12m',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='12-month recession risk (0.0-1.0)',
               existing_nullable=True)
    op.alter_column('country_regime_assessments', 'recession_risk_6m',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='6-month recession risk (0.0-1.0)',
               existing_nullable=True)
    op.alter_column('country_regime_assessments', 'inflation_momentum',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment="Inflation momentum signal: 'accelerating', 'stable', 'subdued', 'falling'",
               existing_nullable=True)
    op.alter_column('country_regime_assessments', 'gdp_momentum',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment="GDP momentum signal: 'strong', 'moderate', 'weak', 'contracting'",
               existing_nullable=True)
    op.alter_column('country_regime_assessments', 'rationale',
               existing_type=sa.TEXT(),
               comment=None,
               existing_comment='Human-readable rationale for regime classification',
               existing_nullable=False)
    op.alter_column('country_regime_assessments', 'transition_probability',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='Probability of regime transition in next 6 months (0.0-1.0)',
               existing_nullable=False)
    op.alter_column('country_regime_assessments', 'confidence',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='Confidence in regime classification (0.0-1.0)',
               existing_nullable=False)
    op.alter_column('country_regime_assessments', 'regime',
               existing_type=sa.VARCHAR(length=30),
               comment=None,
               existing_comment="Regime: 'early_cycle', 'mid_cycle', 'late_cycle', 'recession', 'uncertain'",
               existing_nullable=False)
    op.alter_column('country_regime_assessments', 'assessment_timestamp',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment=None,
               existing_comment='When the assessment was made',
               existing_nullable=False)
    op.alter_column('country_regime_assessments', 'country',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment="Country code (e.g., 'USA', 'Germany')",
               existing_nullable=False)
    op.alter_column('country_regime_assessments', 'baml_analysis_id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='Reference to BAML analysis (if news-enhanced)',
               existing_nullable=True)
    op.alter_column('country_regime_assessments', 'economic_indicators_id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='Reference to country economic indicators',
               existing_nullable=False)
    op.alter_column('country_regime_assessments', 'analysis_run_id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='Reference to parent analysis run',
               existing_nullable=False)
    op.drop_column('country_regime_assessments', 'missing_critical_data')
    op.drop_column('country_regime_assessments', 'data_completeness')
    op.drop_column('country_regime_assessments', 'key_risks')
    op.drop_column('country_regime_assessments', 'classification_confidence_breakdown')
    op.drop_column('country_regime_assessments', 'market_conditions_assessment')
    op.drop_column('country_regime_assessments', 'economic_momentum_assessment')
    op.drop_column('country_regime_assessments', 'recession_rationale')
    op.drop_column('country_regime_assessments', 'transition_timeframe')
    op.drop_column('country_regime_assessments', 'potential_next_regime')
    op.drop_index(op.f('ix_baml_analyses_analysis_timestamp'), table_name='baml_analyses')
    op.drop_index('idx_baml_missing_data_gin', table_name='baml_analyses', postgresql_using='gin')
    op.drop_index('idx_baml_conf_breakdown_gin', table_name='baml_analyses', postgresql_using='gin')
    op.alter_column('baml_analyses', 'sector_drivers',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment=None,
               existing_comment="Sector-specific news drivers (e.g., {'Technology': 'AI boom...'})",
               existing_nullable=True)
    op.alter_column('baml_analyses', 'lagging_sectors',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment=None,
               existing_comment='List of lagging sectors based on news sentiment',
               existing_nullable=True)
    op.alter_column('baml_analyses', 'leading_sectors',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment=None,
               existing_comment='List of leading sectors based on news sentiment',
               existing_nullable=True)
    op.alter_column('baml_analyses', 'sector_adjustments',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment=None,
               existing_comment="Sector weight adjustments from news (e.g., {'Technology': 0.02})",
               existing_nullable=True)
    op.alter_column('baml_analyses', 'transition_signals_list',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment=None,
               existing_comment='List of specific transition signals detected',
               existing_nullable=True)
    op.alter_column('baml_analyses', 'estimated_timeframe',
               existing_type=sa.VARCHAR(length=100),
               comment=None,
               existing_comment="Estimated timeframe for potential transition (e.g., '3-6 months')",
               existing_nullable=True)
    op.alter_column('baml_analyses', 'narrative_themes',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment=None,
               existing_comment='List of dominant narrative themes in news',
               existing_nullable=True)
    op.alter_column('baml_analyses', 'narrative_shift',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment="Narrative shift status: 'emerging', 'stable', 'accelerating'",
               existing_nullable=True)
    op.alter_column('baml_analyses', 'potential_next_regime',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment='Most likely next regime if transition occurs',
               existing_nullable=True)
    op.alter_column('baml_analyses', 'transition_likelihood',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='Likelihood of regime transition (0.0 to 1.0)',
               existing_nullable=True)
    op.alter_column('baml_analyses', 'leading_indicators',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment=None,
               existing_comment='List of leading economic indicators from news',
               existing_nullable=True)
    op.alter_column('baml_analyses', 'warning_signs',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment=None,
               existing_comment='List of recession warning signs from news',
               existing_nullable=True)
    op.alter_column('baml_analyses', 'adjusted_risk_12m',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='Final adjusted 12-month recession risk (0.0 to 1.0)',
               existing_nullable=True)
    op.alter_column('baml_analyses', 'adjusted_risk_6m',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='Final adjusted 6-month recession risk (0.0 to 1.0)',
               existing_nullable=True)
    op.alter_column('baml_analyses', 'risk_adjustment_12m',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='12-month recession risk adjustment from news',
               existing_nullable=True)
    op.alter_column('baml_analyses', 'risk_adjustment_6m',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='6-month recession risk adjustment from news',
               existing_nullable=True)
    op.alter_column('baml_analyses', 'contradiction_warning',
               existing_type=sa.VARCHAR(length=2000),
               comment=None,
               existing_comment='Warning if news contradicts quantitative signals',
               existing_nullable=True)
    op.alter_column('baml_analyses', 'news_sentiment',
               existing_type=sa.VARCHAR(length=1000),
               comment=None,
               existing_comment="Overall news sentiment (e.g., 'cautiously_optimistic', 'bearish')",
               existing_nullable=True)
    op.alter_column('baml_analyses', 'enhanced_rationale',
               existing_type=sa.TEXT(),
               comment=None,
               existing_comment='Enhanced rationale incorporating news analysis',
               existing_nullable=True)
    op.alter_column('baml_analyses', 'adjusted_confidence',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='Final adjusted confidence after news analysis (0.0 to 1.0)',
               existing_nullable=True)
    op.alter_column('baml_analyses', 'confidence_adjustment',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='Confidence adjustment from news (-1.0 to 1.0)',
               existing_nullable=True)
    op.alter_column('baml_analyses', 'analysis_timestamp',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               comment=None,
               existing_comment='When BAML analysis was performed',
               existing_nullable=False)
    op.drop_column('baml_analyses', 'missing_critical_data')
    op.drop_column('baml_analyses', 'data_completeness')
    op.drop_column('baml_analyses', 'classification_confidence_breakdown')
    op.drop_column('baml_analyses', 'market_conditions_assessment')
    op.drop_column('baml_analyses', 'economic_momentum_assessment')
    op.drop_column('baml_analyses', 'recession_rationale')
    # ### end Alembic commands ###
