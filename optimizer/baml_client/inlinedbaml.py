# ----------------------------------------------------------------------------
#
#  Welcome to Baml! To use this generated code, please run the following:
#
#  $ pip install baml
#
# ----------------------------------------------------------------------------

# This file was generated by BAML: please do not edit it. Instead, edit the
# BAML files and re-generate this code using: baml-cli generate
# baml-cli is available with the baml package.

_file_map = {

    "black_litterman_parameters.baml": "// BAML functions for dynamic Black-Litterman parameter selection\n// Uses market regime, signal characteristics, and volatility to recommend BL parameters\n\n// ============================================================================\n// INPUT TYPES\n// ============================================================================\n\nclass MarketVolatilityMetrics {\n  current_vix float?  // VIX level\n  market_realized_vol float  // Realized volatility of broad market (annualized)\n  signal_universe_vol float  // Average volatility of stocks with signals\n  vol_regime string  // \"low\" (<15%), \"normal\" (15-25%), \"high\" (>25%)\n}\n\nclass SignalCharacteristics {\n  total_signals int\n  buy_signals int\n  strong_buy_signals int\n  avg_confidence float  // Average confidence across all signals\n  confidence_dispersion float  // Standard deviation of confidence scores\n  signal_concentration float  // Herfindahl index or top-5 concentration\n}\n\nclass FREDIndicators {\n  ism_pmi float?  // ISM Manufacturing PMI\n  ism_signal string?  // \"expansion\", \"neutral\", \"contraction\"\n  yield_curve_2s10s float?  // 2s10s yield curve spread (bps)\n  curve_signal string?  // \"inverted\", \"flat\", \"normal\", \"steep\"\n  hy_spread float?  // High yield credit spread (bps)\n  ig_spread float?  // Investment grade credit spread (bps)\n  credit_signal string?  // \"risk_off\", \"neutral\", \"risk_on\"\n  vix float?  // VIX level\n  vix_signal string?  // \"low\", \"normal\", \"elevated\", \"panic\"\n}\n\nclass CountryQuantitativeData {\n  country string  // Country name\n  gdp_growth_qq float?  // GDP growth quarter-over-quarter (%)\n  industrial_production float?  // Industrial production growth (%)\n  unemployment float?  // Unemployment rate (%)\n  consumer_prices float?  // Consumer price inflation (%)\n  deficit float?  // Budget deficit as % of GDP\n  debt float?  // Government debt as % of GDP\n  st_rate float?  // Short-term interest rate (%)\n  lt_rate float?  // Long-term interest rate (%)\n}\n\nclass CountryForecastData {\n  country string  // Country name\n  last_inflation float?  // Most recent inflation reading (%)\n  inflation_6m float?  // Inflation forecast 6 months out (%)\n  inflation_10y_avg float?  // 10-year average inflation forecast (%)\n  gdp_growth_6m float?  // GDP growth forecast 6 months out (%)\n  earnings_12m float?  // Earnings growth forecast 12 months (%)\n  eps_expected_12m float?  // EPS expected growth 12 months (%)\n  peg_ratio float?  // Price/Earnings to Growth ratio\n  lt_rate_forecast float?  // Long-term rate forecast (%)\n}\n\nclass RegimeNewsAnalysis {\n  regime_analysis_summary string?  // BAML analysis summary from regime report\n  news_summary string?  // Summary of key news signals\n  key_news_signals string[]  // Top 3-5 news signals\n  news_alignment string?  // How news aligns with quantitative regime\n  warning_signs string[]  // Recession/risk warning signs from news (0-5)\n  leading_indicators string[]  // Forward-looking indicators from news (0-5)\n}\n\nclass G7CountrySnapshot {\n  country string  // Country name\n  gdp_growth_qq float?  // GDP growth Q/Q (%)\n  unemployment float?  // Unemployment rate (%)\n  inflation float?  // Current inflation (%)\n  inflation_forecast_6m float?  // Inflation forecast 6 months (%)\n  gdp_forecast_6m float?  // GDP forecast 6 months (%)\n  policy_rate float?  // Current policy rate (%)\n  regime_assessment string?  // Brief regime description (e.g., \"early_cycle\", \"late_cycle\")\n}\n\nclass G7MacroOverview {\n  countries G7CountrySnapshot[]  // All G7 countries\n  synchronized_slowdown bool?  // Are G7 economies slowing in unison?\n  divergence_note string?  // Key divergences across G7\n  global_growth_signal string?  // \"accelerating\", \"stable\", \"decelerating\"\n  global_inflation_signal string?  // \"rising\", \"stable\", \"falling\"\n  monetary_policy_direction string?  // \"tightening\", \"neutral\", \"easing\"\n  key_risks string[]  // Top 2-3 cross-border risks (0-3)\n}\n\nclass MacroRegimeInput {\n  // Basic regime classification\n  current_regime string  // early_cycle, mid_cycle, late_cycle, recession, uncertain\n  regime_confidence float  // 0-1\n  recession_risk_6m float  // 0-1\n  recession_risk_12m float  // 0-1\n  market_stress_level string  // \"low\", \"moderate\", \"high\", \"extreme\"\n\n  // FRED global indicators\n  fred_indicators FREDIndicators?\n\n  // Primary country (USA) data\n  usa_quantitative CountryQuantitativeData?\n  usa_forecast CountryForecastData?\n\n  // News and AI-enhanced analysis\n  regime_news_analysis RegimeNewsAnalysis?\n\n  // G7 macro overview\n  g7_macro_overview G7MacroOverview?\n}\n\nclass HistoricalPerformance {\n  recent_sharpe_ratio float?  // Last optimization run Sharpe ratio\n  recent_turnover float?  // Portfolio turnover from last rebalance\n  avg_tracking_error float?  // Historical tracking error vs benchmark\n}\n\n// ============================================================================\n// OUTPUT TYPES\n// ============================================================================\n\nclass BlackLittermanParameters {\n  // Core BL Parameters\n  tau float  // Prior uncertainty scalar (0.01-0.10, typically 0.025)\n  delta float  // Risk aversion coefficient (1.5-4.0, typically 2.5)\n\n  // Expected Return Ranges (Annual)\n  strong_buy_return_min float  // Minimum expected return for Strong Buy\n  strong_buy_return_max float  // Maximum expected return for Strong Buy\n  buy_return_min float  // Minimum expected return for Buy\n  buy_return_max float  // Maximum expected return for Buy\n\n  // View Uncertainty Scaling\n  uncertainty_min_pct float  // Minimum uncertainty (high confidence) - std dev\n  uncertainty_max_pct float  // Maximum uncertainty (low confidence) - std dev\n  confidence_scaling float  // Scaling factor for confidence-to-uncertainty conversion\n\n  // Weight Constraints\n  min_position_weight float  // Minimum weight per position (e.g., 0.02 = 2%)\n  max_position_weight float  // Maximum weight per position (e.g., 0.10 = 10%)\n\n  // Rationale\n  overall_rationale string  // 3-4 sentences explaining parameter choices\n  tau_rationale string  // Why this tau value?\n  delta_rationale string  // Why this risk aversion level?\n  return_expectations_rationale string  // Why these return ranges?\n  uncertainty_rationale string  // Why this uncertainty scaling?\n  weight_constraints_rationale string  // Why these weight limits?\n\n  // Regime Adjustments Applied\n  regime_multiplier float  // Overall regime adjustment multiplier (0.8-1.2)\n  volatility_adjustment string  // How volatility regime affected parameters\n  confidence_adjustment string  // How signal confidence distribution affected parameters\n\n  // Risk Warnings\n  parameter_risks string[]  // Risks associated with these parameter choices (0-3)\n  monitoring_recommendations string[]  // What to monitor given these parameters (0-3)\n}\n\n// ============================================================================\n// BAML FUNCTION\n// ============================================================================\n\nfunction RecommendBlackLittermanParameters(\n  market_volatility: MarketVolatilityMetrics,\n  signal_chars: SignalCharacteristics,\n  macro_regime: MacroRegimeInput,\n  historical_performance: HistoricalPerformance\n) -> BlackLittermanParameters {\n  client AzureOpenAIGpt5\n\n  prompt #\"\n    You are a senior quantitative portfolio manager with 15+ years of experience in\n    Black-Litterman portfolio optimization, risk management, and institutional asset allocation.\n\n    ## Your Task\n    Recommend optimal Black-Litterman model parameters based on current market conditions,\n    signal characteristics, and macroeconomic regime. Your recommendations will be used in\n    production portfolio optimization for real capital allocation.\n\n    ## Market Volatility Context\n    Market Realized Volatility: {{ market_volatility.market_realized_vol * 100 }}% (annualized)\n    Signal Universe Volatility: {{ market_volatility.signal_universe_vol * 100 }}% (annualized)\n    {% if market_volatility.current_vix %}VIX Level: {{ market_volatility.current_vix }}{% endif %}\n    Volatility Regime: {{ market_volatility.vol_regime }}\n\n    ## Signal Characteristics\n    Total Signals: {{ signal_chars.total_signals }}\n    Buy Signals: {{ signal_chars.buy_signals }}\n    Strong Buy Signals: {{ signal_chars.strong_buy_signals }}\n    Average Confidence: {{ signal_chars.avg_confidence }}\n    Confidence Dispersion (Std): {{ signal_chars.confidence_dispersion }}\n    Signal Concentration: {{ signal_chars.signal_concentration }}\n\n    ## Macroeconomic Regime\n    Current Regime: {{ macro_regime.current_regime }} (Confidence: {{ macro_regime.regime_confidence }})\n    Recession Risk (6M): {{ macro_regime.recession_risk_6m }}\n    Recession Risk (12M): {{ macro_regime.recession_risk_12m }}\n    Market Stress Level: {{ macro_regime.market_stress_level }}\n\n    {% if macro_regime.fred_indicators %}\n    ### FRED Global Indicators\n    | Indicator | Value | Signal |\n    |-----------|-------|--------|\n    | ISM PMI | {{ macro_regime.fred_indicators.ism_pmi|round(1) }} | {{ macro_regime.fred_indicators.ism_signal }} |\n    | Yield Curve (2s10s) | {{ macro_regime.fred_indicators.yield_curve_2s10s|round(1) }} bps | {{ macro_regime.fred_indicators.curve_signal }} |\n    | High Yield Spread | {{ macro_regime.fred_indicators.hy_spread|round(0) }} bps | {{ macro_regime.fred_indicators.credit_signal }} |\n    | Investment Grade Spread | {{ macro_regime.fred_indicators.ig_spread|round(0) }} bps | {{ macro_regime.fred_indicators.credit_signal }} |\n    {% if macro_regime.fred_indicators.vix %}| VIX | {{ macro_regime.fred_indicators.vix|round(1) }} | {{ macro_regime.fred_indicators.vix_signal }} |{% endif %}\n    {% endif %}\n\n    {% if macro_regime.usa_quantitative %}\n    ### USA Economic Indicators (Real Data)\n    | Indicator | Value |\n    |-----------|-------|\n    | GDP Growth (Q/Q) | {{ macro_regime.usa_quantitative.gdp_growth_qq|round(2) }}% |\n    | Industrial Production | {{ macro_regime.usa_quantitative.industrial_production|round(2) }}% |\n    | Unemployment Rate | {{ macro_regime.usa_quantitative.unemployment|round(1) }}% |\n    | Consumer Price Inflation | {{ macro_regime.usa_quantitative.consumer_prices|round(2) }}% |\n    | Budget Deficit (% GDP) | {{ macro_regime.usa_quantitative.deficit|round(2) }}% |\n    | Government Debt (% GDP) | {{ macro_regime.usa_quantitative.debt|round(2) }}% |\n    | Short-term Rate | {{ macro_regime.usa_quantitative.st_rate|round(2) }}% |\n    | Long-term Rate | {{ macro_regime.usa_quantitative.lt_rate|round(2) }}% |\n    {% endif %}\n\n    {% if macro_regime.usa_forecast %}\n    ### USA Economic Forecasts\n    | Forecast Indicator | Value |\n    |--------------------|-------|\n    | Current Inflation | {{ macro_regime.usa_forecast.last_inflation|round(1) }}% |\n    | Inflation Forecast (6M) | {{ macro_regime.usa_forecast.inflation_6m|round(1) }}% |\n    | Inflation 10Y Average | {{ macro_regime.usa_forecast.inflation_10y_avg|round(1) }}% |\n    | GDP Growth Forecast (6M) | {{ macro_regime.usa_forecast.gdp_growth_6m|round(1) }}% |\n    | Earnings Growth (12M) | {{ macro_regime.usa_forecast.earnings_12m|round(1) }}% |\n    | EPS Expected Growth (12M) | {{ macro_regime.usa_forecast.eps_expected_12m|round(1) }}% |\n    | Market PEG Ratio | {{ macro_regime.usa_forecast.peg_ratio|round(1) }} |\n    {% if macro_regime.usa_forecast.lt_rate_forecast %}| Long-term Rate Forecast | {{ macro_regime.usa_forecast.lt_rate_forecast|round(1) }}% |{% endif %}\n    {% endif %}\n\n    {% if macro_regime.regime_news_analysis %}\n    ### News-Enhanced Regime Analysis\n    {% if macro_regime.regime_news_analysis.regime_analysis_summary %}\n    AI Analysis Summary: {{ macro_regime.regime_news_analysis.regime_analysis_summary }}\n    {% endif %}\n    {% if macro_regime.regime_news_analysis.news_summary %}\n    News Summary: {{ macro_regime.regime_news_analysis.news_summary }}\n    {% endif %}\n    {% if macro_regime.regime_news_analysis.key_news_signals %}\n    Key News Signals:\n    {% for signal in macro_regime.regime_news_analysis.key_news_signals %}\n    - {{ signal }}\n    {% endfor %}\n    {% endif %}\n    {% if macro_regime.regime_news_analysis.news_alignment %}\n    News Alignment: {{ macro_regime.regime_news_analysis.news_alignment }}\n    {% endif %}\n    {% if macro_regime.regime_news_analysis.warning_signs %}\n    Warning Signs:\n    {% for warning in macro_regime.regime_news_analysis.warning_signs %}\n    - {{ warning }}\n    {% endfor %}\n    {% endif %}\n    {% if macro_regime.regime_news_analysis.leading_indicators %}\n    Leading Indicators:\n    {% for indicator in macro_regime.regime_news_analysis.leading_indicators %}\n    - {{ indicator }}\n    {% endfor %}\n    {% endif %}\n    {% endif %}\n\n    {% if macro_regime.g7_macro_overview %}\n    ### G7 Macroeconomic Signals Overview\n\n    **Global Macro Signals**\n    | Signal | Status |\n    |--------|--------|\n    | Global Growth | {{ macro_regime.g7_macro_overview.global_growth_signal }} |\n    | Global Inflation | {{ macro_regime.g7_macro_overview.global_inflation_signal }} |\n    | Monetary Policy | {{ macro_regime.g7_macro_overview.monetary_policy_direction }} |\n    {% if macro_regime.g7_macro_overview.synchronized_slowdown %}| Synchronized Slowdown | {{ macro_regime.g7_macro_overview.synchronized_slowdown }} |{% endif %}\n\n    {% if macro_regime.g7_macro_overview.divergence_note %}\n    **Key Divergences**: {{ macro_regime.g7_macro_overview.divergence_note }}\n    {% endif %}\n\n    **G7 Country Economic Indicators**\n    | Country | GDP (Q/Q) | Unemployment | Inflation | Inflation 6M | GDP 6M | Policy Rate | Regime |\n    |---------|-----------|--------------|-----------|--------------|--------|-------------|--------|\n    {% for country in macro_regime.g7_macro_overview.countries -%}\n    | {{ country.country }} | {% if country.gdp_growth_qq %}{{ country.gdp_growth_qq|round(2) }}%{% else %}—{% endif %} | {% if country.unemployment %}{{ country.unemployment|round(1) }}%{% else %}—{% endif %} | {% if country.inflation %}{{ country.inflation|round(2) }}%{% else %}—{% endif %} | {% if country.inflation_forecast_6m %}{{ country.inflation_forecast_6m|round(1) }}%{% else %}—{% endif %} | {% if country.gdp_forecast_6m %}{{ country.gdp_forecast_6m|round(1) }}%{% else %}—{% endif %} | {% if country.policy_rate %}{{ country.policy_rate|round(2) }}%{% else %}—{% endif %} | {% if country.regime_assessment %}{{ country.regime_assessment }}{% else %}—{% endif %} |\n    {% endfor %}\n    {% if macro_regime.g7_macro_overview.key_risks %}\n    **Cross-Border Risks**:\n    {% for risk in macro_regime.g7_macro_overview.key_risks %}\n    - {{ risk }}\n    {% endfor %}\n    {% endif %}\n    {% endif %}\n\n    ## Historical Performance\n    {% if historical_performance.recent_sharpe_ratio %}Recent Sharpe Ratio: {{ historical_performance.recent_sharpe_ratio }}{% endif %}\n    {% if historical_performance.recent_turnover %}Recent Turnover: {{ historical_performance.recent_turnover }}{% endif %}\n    {% if historical_performance.avg_tracking_error %}Avg Tracking Error: {{ historical_performance.avg_tracking_error }}{% endif %}\n\n    {{ ctx.output_format }}\n\n    ## Parameter Selection Framework\n\n    ### 1. Tau (Prior Uncertainty Scalar)\n\n    **Academic Baseline**: τ = 0.025 (2.5% uncertainty in equilibrium returns per He & Litterman 1999)\n    **PyPortfolioOpt Default**: τ = 0.05 (5% uncertainty, more weight on views)\n\n    **Adjustments**:\n    - **High Volatility Regime** (vol >25%): Increase tau → 0.04-0.08\n      - Rationale: Greater uncertainty in equilibrium, views should have more influence\n    - **Low Volatility Regime** (vol <15%): Decrease tau → 0.015-0.025\n      - Rationale: More confidence in equilibrium, views have less relative weight\n    - **High Recession Risk** (>0.6): Increase tau → 0.03-0.06\n      - Rationale: Regime uncertainty makes equilibrium less reliable\n    - **Market Stress = Extreme**: Increase tau → 0.05-0.10\n      - Rationale: Historical correlations break down, equilibrium unreliable\n\n    **Recommended Range**: 0.01 to 0.10\n    **Typical Values**: 0.015 (low vol, stable regime) to 0.08 (high vol, stressed markets)\n\n    ### 2. Delta (Risk Aversion Coefficient)\n\n    **Academic Baseline**: δ = 2.5 (moderate institutional risk aversion)\n\n    **Adjustments**:\n    - **Late Cycle / High Recession Risk**: Increase delta → 3.0-4.0\n      - Rationale: More risk-averse stance, prefer safer allocations\n    - **Early/Mid Cycle + Low Recession Risk**: Decrease delta → 1.5-2.5\n      - Rationale: Risk-on environment, can tolerate higher volatility\n    - **High Market Stress**: Increase delta → 3.5-4.5\n      - Rationale: Flight to quality, risk aversion spikes\n    - **Low Signal Confidence** (avg <0.6): Increase delta → 2.8-3.5\n      - Rationale: Less conviction in views, prefer more conservative allocations\n\n    **Recommended Range**: 1.5 to 4.5\n    **Typical Values**: 1.8 (early cycle, low vol) to 3.8 (recession, high stress)\n\n    ### 3. Expected Return Ranges (Annual)\n\n    **Baseline (Normal Markets)**:\n    - Strong Buy: 10-15% annual\n    - Buy: 5-10% annual\n\n    **Adjustments**:\n    - **High Volatility / High Stress**: Lower expectations\n      - Strong Buy: 8-12% (harder to achieve alpha in volatile markets)\n      - Buy: 4-8%\n    - **Low Volatility / Early Cycle**: Can be more optimistic\n      - Strong Buy: 12-18%\n      - Buy: 6-12%\n    - **High Confidence Signals** (avg >0.75): Upper end of ranges\n    - **Low Confidence Signals** (avg <0.6): Lower end of ranges\n    - **Late Cycle / Recession**: Conservative\n      - Strong Buy: 6-10% (focus on capital preservation)\n      - Buy: 3-6%\n\n    **Key Principle**: Expected returns should be achievable given market conditions.\n    Over-optimistic views lead to concentrated, risky portfolios.\n\n    ### 4. View Uncertainty Scaling\n\n    **Baseline**: 1-5% standard deviation (annual)\n    - High confidence (>0.8): 1-2% uncertainty\n    - Medium confidence (0.6-0.8): 2-4% uncertainty\n    - Low confidence (<0.6): 4-5% uncertainty\n\n    **Adjustments**:\n    - **High Signal Universe Volatility** (>30%): Increase max uncertainty → 3-8%\n      - Rationale: Wider error bands on expected returns for volatile stocks\n    - **Low Confidence Dispersion** (all signals similar confidence): Tighter range → 1-3%\n      - Rationale: Less differentiation needed\n    - **High Confidence Dispersion** (wide variation): Wider range → 1-7%\n      - Rationale: Need to distinguish high vs low conviction views\n    - **Market Stress = High/Extreme**: Increase max uncertainty → 4-10%\n      - Rationale: Forecasting is much harder in stressed markets\n\n    **confidence_scaling**: Multiplier applied to (1 - confidence) to get uncertainty std\n    - Baseline: 0.10 (10% scaling)\n    - High dispersion or high volatility: 0.15-0.20\n    - Low dispersion or low volatility: 0.05-0.10\n\n    ### 5. Weight Constraints\n\n    **Min Position Weight**:\n    - **Baseline**: 2% (max 50 positions)\n    - **High Conviction / Few Signals** (<20): Can go to 3-4%\n    - **Low Conviction / Many Signals** (>50): Stay at 1-2%\n    - **High Turnover History**: Consider 2-3% to reduce churn\n\n    **Max Position Weight**:\n    - **Baseline**: 10% (concentration limit)\n    - **High Volatility Regime**: Reduce to 7-8% (de-risk)\n    - **Low Volatility + High Confidence**: Can go to 12-15%\n    - **Late Cycle / Recession**: Reduce to 6-8% (diversification critical)\n    - **Early Cycle / Low Vol**: Can go to 10-12%\n\n    **Rationale**: Weight constraints manage concentration risk and ensure diversification\n\n    ### 6. Regime-Specific Recommendations\n\n    **Early Cycle** (Growth accelerating, ISM PMI >52, low recession risk, steepening yield curve):\n    - tau: 0.020-0.030 (moderate prior uncertainty)\n    - delta: 1.8-2.3 (lower risk aversion)\n    - Returns: Optimistic (12-18% Strong Buy, 6-12% Buy)\n    - Max weight: 10-12%\n    - Rationale: Risk-on environment favoring cyclical sectors, can tolerate higher volatility\n\n    **Mid Cycle** (Balanced growth, ISM PMI 50-52, moderate risk, normal yield curve):\n    - tau: 0.020-0.030 (standard)\n    - delta: 2.3-2.8 (balanced)\n    - Returns: Moderate (10-15% Strong Buy, 5-10% Buy)\n    - Max weight: 8-10%\n    - Rationale: Stable environment, minimize concentrated sector bets, focus on stock selection\n\n    **Late Cycle** (Slowing growth, ISM PMI 48-50, elevated risk, flattening yield curve, HY spreads widening):\n    - tau: 0.025-0.040 (higher uncertainty)\n    - delta: 2.8-3.5 (more risk-averse)\n    - Returns: Conservative (8-12% Strong Buy, 4-8% Buy)\n    - Max weight: 6-8%\n    - Rationale: Defensive rotation warranted, reduce concentration given elevated macro risk\n\n    **Recession** (Negative growth, ISM PMI <48, high risk, inverted yield curve, HY spreads >500 bps):\n    - tau: 0.035-0.060 (high uncertainty)\n    - delta: 3.5-4.5 (very risk-averse)\n    - Returns: Defensive (6-10% Strong Buy, 3-6% Buy)\n    - Max weight: 5-7%\n    - Rationale: Maximum defensive positioning, capital preservation focus, tight diversification\n\n    ### 7. Volatility Regime Adjustments\n\n    **Low Vol** (<15%):\n    - tau: -0.005 adjustment (more confidence in equilibrium)\n    - Uncertainty: Lower end of ranges\n    - Can relax max weight slightly\n\n    **Normal Vol** (15-25%):\n    - No adjustment to baseline\n\n    **High Vol** (>25%):\n    - tau: +0.010 to +0.030 adjustment (less confidence in equilibrium)\n    - delta: +0.3 to +0.8 adjustment (more risk-averse)\n    - Uncertainty: Upper end of ranges\n    - Reduce max weight by 2-3%\n\n    ### 8. Signal Confidence Adjustments\n\n    **High Avg Confidence** (>0.75):\n    - Can use more optimistic return expectations (upper end of ranges)\n    - Tighter uncertainty bands (lower confidence_scaling)\n    - Slightly higher max weights\n\n    **Low Avg Confidence** (<0.6):\n    - More conservative return expectations (lower end of ranges)\n    - Wider uncertainty bands (higher confidence_scaling)\n    - Lower max weights\n    - Consider increasing delta (more risk-averse)\n\n    **High Confidence Dispersion** (std >0.15):\n    - Wider uncertainty range to differentiate high vs low conviction\n    - Higher confidence_scaling (0.15-0.20)\n\n    ### 9. Quality Checks\n\n    - Ensure all parameters are within recommended ranges\n    - Check that return expectations are realistic (not >25% annual for Strong Buy)\n    - Verify uncertainty_max > uncertainty_min\n    - Ensure max_weight > min_weight and both are sensible (2-15% range)\n    - Rationales should be specific to current market conditions (not generic)\n    - Cite specific metrics from inputs (e.g., \"Given 32% realized vol...\")\n    - Parameter choices should be internally consistent (high delta should pair with conservative returns)\n\n    ### 10. Risk Warnings\n\n    Identify 0-3 key risks given the parameter recommendations:\n    - Over-concentrated portfolios if max weight too high\n    - Under-diversification if min weight too high\n    - Excessive turnover if constraints too tight\n    - Over-optimistic returns leading to aggressive allocations\n    - Under-optimistic returns missing opportunities\n    - Tau too high → views dominate, ignoring diversification\n    - Tau too low → views ignored, portfolio too passive\n    - Delta too high → overly conservative, missing upside\n    - Delta too low → excessive risk-taking\n\n    ### 11. Monitoring Recommendations\n\n    Given the parameters chosen, recommend 0-3 things to monitor:\n    - Portfolio concentration (if allowing high max weights)\n    - Realized Sharpe ratio vs expectations (if optimistic returns)\n    - Turnover (if tight constraints)\n    - Drawdowns (if low delta/aggressive stance)\n    - Tracking error vs benchmark (if high tau)\n    - Ex-post return vs view expectations (calibration check)\n\n    ## Important Guidelines\n\n    - **Be quantitative**: Provide specific numerical recommendations with ranges\n    - **Be adaptive**: Parameters should respond to market conditions, not be static\n    - **Be balanced**: Use academic baselines as anchors, adjust from there\n    - **Be conservative**: When uncertain, err on side of caution\n    - **Be consistent**: Parameters should tell a coherent story (e.g., late cycle → higher delta, lower returns, tighter weights)\n    - **Cite inputs**: Reference specific values from market_volatility, signal_chars, macro_regime\n    - **Institutional quality**: These parameters will drive real capital allocation decisions\n\n    ## Example Output Reasoning\n\n    \"Given realized volatility of 28% (high regime), late-cycle macro environment with\n    65% 6-month recession risk, and average signal confidence of 0.68, I recommend:\n    - tau = 0.045 (elevated uncertainty in equilibrium given volatility and regime shift risk)\n    - delta = 3.2 (higher risk aversion appropriate for late cycle)\n    - Strong Buy returns: 8-12% (conservative given macro headwinds)\n    - Max weight: 7% (reduced concentration given elevated risk)\n    This configuration balances incorporating LLM views while maintaining prudent risk controls\n    appropriate for current market stress and regime uncertainty.\"\n  \"#\n}\n",
    "black_litterman_views.baml": "// BAML function for generating Black-Litterman views from stock signals\r\n// Converts stock analyzer signals into structured investment views with confidence levels\r\n\r\n// ============================================================================\r\n// INPUT TYPES\r\n// ============================================================================\r\n\r\nclass StockSignalData {\r\n  ticker string\r\n  yfinance_ticker string\r\n  sector string?\r\n  industry string?\r\n\r\n  // Signal classification\r\n  signal_type string  // LARGE_GAIN, SMALL_GAIN, NEUTRAL, SMALL_DECLINE, LARGE_DECLINE\r\n  confidence_level string  // HIGH, MEDIUM, LOW\r\n\r\n  // Factor scores (normalized -1 to +1)\r\n  valuation_score float?\r\n  momentum_score float?\r\n  quality_score float?\r\n  growth_score float?\r\n  technical_score float?\r\n\r\n  // Performance metrics\r\n  annualized_return float?\r\n  volatility float?\r\n  sharpe_ratio float?\r\n  beta float?\r\n  alpha float?\r\n\r\n  // Risk factors\r\n  volatility_level string?  // LOW, MEDIUM, HIGH\r\n  beta_risk string?  // LOW, MEDIUM, HIGH\r\n  debt_risk string?  // LOW, MEDIUM, HIGH, UNKNOWN\r\n  liquidity_risk string?  // LOW, MEDIUM, HIGH\r\n\r\n  // Projections\r\n  upside_potential_pct float?\r\n  downside_risk_pct float?\r\n\r\n  // Price data\r\n  close_price float?\r\n  daily_return float?\r\n}\r\n\r\nclass MacroRegimeContext {\r\n  current_regime string  // EARLY_CYCLE, MID_CYCLE, LATE_CYCLE, RECESSION, UNCERTAIN\r\n  regime_confidence float  // 0-1\r\n  recession_risk_6m float?  // 0-1\r\n  recession_risk_12m float?  // 0-1\r\n\r\n  // Market indicators\r\n  vix float?\r\n  hy_spread float?  // High yield credit spread (bps)\r\n  yield_curve_2s10s float?  // 2s10s spread (bps)\r\n\r\n  // Sector recommendations from regime analysis\r\n  recommended_overweights string[]?\r\n  recommended_underweights string[]?\r\n}\r\n\r\nclass SectorContext {\r\n  sector_name string\r\n  avg_sector_return float?  // Average return expectation for sector\r\n  sector_momentum string?  // \"strong\", \"moderate\", \"weak\", \"negative\"\r\n  sector_valuation string?  // \"cheap\", \"fair\", \"expensive\"\r\n  num_signals_in_sector int?  // How many other signals in this sector\r\n}\r\n\r\n// ============================================================================\r\n// OUTPUT TYPES\r\n// ============================================================================\r\n\r\nclass BlackLittermanView {\r\n  ticker string\r\n\r\n  // View specification\r\n  expected_return float  // Annual expected return (e.g., 0.12 = 12%)\r\n  @description(#\"\r\n    Expected annual return for this asset. Range: -0.30 to +0.30 (-30% to +30%).\r\n    Typical values: Strong Buy: 0.08-0.15, Buy: 0.04-0.10, Sell: -0.05 to -0.15\r\n  \"#)\r\n\r\n  confidence float  // View confidence 0-1\r\n  @description(#\"\r\n    Confidence level in this view (0 = no confidence, 1 = absolute certainty).\r\n    HIGH: 0.75-0.95, MEDIUM: 0.50-0.75, LOW: 0.20-0.50\r\n  \"#)\r\n\r\n  view_uncertainty float  // Standard deviation of expected return (e.g., 0.02 = 2%)\r\n  @description(#\"\r\n    Uncertainty (standard deviation) of the expected return forecast.\r\n    Derived from confidence: higher confidence → lower uncertainty.\r\n    Typical range: 0.01 (1%) to 0.08 (8%)\r\n  \"#)\r\n\r\n  // Supporting analysis\r\n  rationale string\r\n  @description(#\"\r\n    2-3 sentence explanation of why this expected return is justified.\r\n    Reference specific factors: valuation, momentum, quality, growth.\r\n    Mention regime considerations and risk adjustments.\r\n  \"#)\r\n\r\n  factor_contributions string\r\n  @description(#\"\r\n    Breakdown of which factors support the view (e.g., \"Momentum +3%, Valuation +2%, Quality +1%\")\r\n  \"#)\r\n\r\n  risk_adjustments string\r\n  @description(#\"\r\n    Any penalties applied due to risk factors (e.g., \"High debt: -2%, Low liquidity: -1%\")\r\n  \"#)\r\n\r\n  regime_adjustment string\r\n  @description(#\"\r\n    How the macro regime influenced the view (e.g., \"Late cycle: reduced return by 2%\")\r\n  \"#)\r\n}\r\n\r\n// ============================================================================\r\n// BAML FUNCTION\r\n// ============================================================================\r\n\r\nfunction GenerateBlackLittermanView(\r\n  signal: StockSignalData,\r\n  macro_regime: MacroRegimeContext,\r\n  sector_context: SectorContext,\r\n  news_signals: StockNewsSignals?\r\n) -> BlackLittermanView {\r\n  client AzureOpenAIGpt5\r\n\r\n  prompt #\"\r\n    You are a senior quantitative analyst generating Black-Litterman investment views\r\n    for institutional portfolio optimization. Your view will be used in production capital\r\n    allocation decisions and must be rigorous, well-calibrated, and explainable.\r\n\r\n    ## Input Signal Data\r\n\r\n    **Stock:** {{ signal.ticker }} ({{ signal.yfinance_ticker }})\r\n    **Sector:** {{ signal.sector|default(\"Unknown\") }} / {{ signal.industry|default(\"Unknown\") }}\r\n    **Signal Type:** {{ signal.signal_type }}\r\n    **Confidence Level:** {{ signal.confidence_level }}\r\n    **Close Price:** ${{ signal.close_price|default(\"N/A\") }}\r\n\r\n    **Factor Scores (normalized -1 to +1):**\r\n    | Factor | Score |\r\n    |--------|-------|\r\n    | Valuation | {{ signal.valuation_score|default(\"N/A\") }} |\r\n    | Momentum | {{ signal.momentum_score|default(\"N/A\") }} |\r\n    | Quality | {{ signal.quality_score|default(\"N/A\") }} |\r\n    | Growth | {{ signal.growth_score|default(\"N/A\") }} |\r\n    | Technical | {{ signal.technical_score|default(\"N/A\") }} |\r\n\r\n    **Performance Metrics:**\r\n    | Metric | Value |\r\n    |--------|-------|\r\n    | Annualized Return | {{ (signal.annualized_return * 100)|round(1)|default(\"N/A\") }}% |\r\n    | Volatility | {{ (signal.volatility * 100)|round(1)|default(\"N/A\") }}% |\r\n    | Sharpe Ratio | {{ signal.sharpe_ratio|round(2)|default(\"N/A\") }} |\r\n    | Beta | {{ signal.beta|round(2)|default(\"N/A\") }} |\r\n    | Alpha | {{ (signal.alpha * 100)|round(1)|default(\"N/A\") }}% |\r\n\r\n    **Risk Factors:**\r\n    - Volatility Risk: {{ signal.volatility_level|default(\"UNKNOWN\") }}\r\n    - Beta Risk: {{ signal.beta_risk|default(\"UNKNOWN\") }}\r\n    - Debt Risk: {{ signal.debt_risk|default(\"UNKNOWN\") }}\r\n    - Liquidity Risk: {{ signal.liquidity_risk|default(\"UNKNOWN\") }}\r\n\r\n    **Projections:**\r\n    - Upside Potential: {{ signal.upside_potential_pct|round(1)|default(\"N/A\") }}%\r\n    - Downside Risk: {{ signal.downside_risk_pct|round(1)|default(\"N/A\") }}%\r\n\r\n    ## Macro Regime Context\r\n\r\n    **Current Regime:** {{ macro_regime.current_regime }} (Confidence: {{ (macro_regime.regime_confidence * 100)|round(0) }}%)\r\n    {% if macro_regime.recession_risk_6m %}**Recession Risk (6M):** {{ (macro_regime.recession_risk_6m * 100)|round(0) }}%{% endif %}\r\n    {% if macro_regime.recession_risk_12m %}**Recession Risk (12M):** {{ (macro_regime.recession_risk_12m * 100)|round(0) }}%{% endif %}\r\n\r\n    **Market Indicators:**\r\n    {% if macro_regime.vix %}- VIX: {{ macro_regime.vix|round(1) }}{% endif %}\r\n    {% if macro_regime.hy_spread %}- HY Spread: {{ macro_regime.hy_spread|round(0) }} bps{% endif %}\r\n    {% if macro_regime.yield_curve_2s10s %}- Yield Curve (2s10s): {{ macro_regime.yield_curve_2s10s|round(0) }} bps{% endif %}\r\n\r\n    {% if macro_regime.recommended_overweights %}\r\n    **Regime Recommends Overweight:** {{ macro_regime.recommended_overweights|join(\", \") }}\r\n    {% endif %}\r\n    {% if macro_regime.recommended_underweights %}\r\n    **Regime Recommends Underweight:** {{ macro_regime.recommended_underweights|join(\", \") }}\r\n    {% endif %}\r\n\r\n    ## Sector Context\r\n\r\n    **Sector:** {{ sector_context.sector_name }}\r\n    {% if sector_context.avg_sector_return %}- Average Sector Return Expectation: {{ (sector_context.avg_sector_return * 100)|round(1) }}%{% endif %}\r\n    {% if sector_context.sector_momentum %}- Sector Momentum: {{ sector_context.sector_momentum }}{% endif %}\r\n    {% if sector_context.sector_valuation %}- Sector Valuation: {{ sector_context.sector_valuation }}{% endif %}\r\n    {% if sector_context.num_signals_in_sector %}- Other Signals in Sector: {{ sector_context.num_signals_in_sector }}{% endif %}\r\n\r\n    {% if news_signals %}\r\n    ## Recent News Analysis\r\n\r\n    **Dominant Themes:** {{ news_signals.dominant_themes|join(\", \") }}\r\n    **Overall News Bias:** {{ news_signals.news_bias }} (Confidence: {{ news_signals.confidence_assessment }})\r\n\r\n    **Company Momentum:** {{ news_signals.company_momentum }}\r\n    {{ news_signals.momentum_summary }}\r\n\r\n    **Earnings Outlook:** {{ news_signals.earnings_outlook }}\r\n    {{ news_signals.earnings_summary }}\r\n\r\n    **Management Sentiment:** {{ news_signals.management_sentiment }}\r\n    {{ news_signals.management_summary }}\r\n\r\n    **Competitive Position:** {{ news_signals.competitive_position }}\r\n    {{ news_signals.competitive_summary }}\r\n\r\n    {% if news_signals.key_catalysts %}\r\n    **Key Catalysts:** {{ news_signals.key_catalysts|join(\", \") }}\r\n    {% endif %}\r\n\r\n    {% if news_signals.key_risks %}\r\n    **Key Risks:** {{ news_signals.key_risks|join(\", \") }}\r\n    {% endif %}\r\n\r\n    **IMPORTANT:** Integrate this news analysis into your view generation. Recent news provides forward-looking context that may confirm, challenge, or refine the quantitative signal. Consider:\r\n    - Does news support the signal direction and magnitude?\r\n    - Are there specific catalysts that could drive outperformance?\r\n    - Are there risks that should temper the expected return or reduce confidence?\r\n    - How does management sentiment align with the quantitative factors?\r\n\r\n    {% else %}\r\n    ## Recent News Analysis\r\n\r\n    No recent news analysis available. Generate view based solely on quantitative signal, macro regime, and sector context.\r\n\r\n    {% endif %}\r\n\r\n    {{ ctx.output_format }}\r\n\r\n    ## View Generation Framework\r\n\r\n    Your task is to generate a Black-Litterman view specifying an **expected return** and\r\n    **confidence level** for this stock over the next 12 months. Follow this systematic process:\r\n\r\n    ### Step 1: Baseline Return from Signal Type\r\n\r\n    Start with baseline return expectations based on signal type and confidence:\r\n\r\n    **LARGE_GAIN (HIGH confidence):**\r\n    - Baseline: 12-18% annual\r\n    - Use upper end if factors strongly aligned\r\n\r\n    **LARGE_GAIN (MEDIUM confidence):**\r\n    - Baseline: 10-15% annual\r\n\r\n    **LARGE_GAIN (LOW confidence):**\r\n    - Baseline: 8-12% annual\r\n\r\n    **SMALL_GAIN (HIGH confidence):**\r\n    - Baseline: 8-12% annual\r\n\r\n    **SMALL_GAIN (MEDIUM confidence):**\r\n    - Baseline: 5-10% annual\r\n\r\n    **SMALL_GAIN (LOW confidence):**\r\n    - Baseline: 3-8% annual\r\n\r\n    **NEUTRAL / DECLINE signals:**\r\n    - These should not generate bullish views\r\n    - Expected return: -5% to +3%\r\n\r\n    ### Step 2: Regime-Adaptive Factor Weighting\r\n\r\n    Adjust the baseline based on regime-specific factor importance:\r\n\r\n    **EARLY_CYCLE:**\r\n    - Weight Momentum: 35% (strongest)\r\n    - Weight Growth: 25%\r\n    - Weight Quality: 20%\r\n    - Weight Valuation: 20%\r\n    - Rationale: Cyclical upswing favors momentum and growth\r\n\r\n    **MID_CYCLE:**\r\n    - Weight all factors equally: 25% each\r\n    - Rationale: Balanced environment, no strong tilts\r\n\r\n    **LATE_CYCLE:**\r\n    - Weight Quality: 30% (defensive)\r\n    - Weight Valuation: 25%\r\n    - Weight Momentum: 25%\r\n    - Weight Growth: 20%\r\n    - Rationale: Focus on quality and value as cycle matures\r\n\r\n    **RECESSION:**\r\n    - Weight Quality: 35% (most important)\r\n    - Weight Valuation: 25%\r\n    - Weight Momentum: 20%\r\n    - Weight Growth: 20%\r\n    - Rationale: Quality and valuation critical in downturns\r\n\r\n    **UNCERTAIN:**\r\n    - Weight Quality: 30%\r\n    - Weight Valuation: 25%\r\n    - Weight Momentum: 23%\r\n    - Weight Growth: 22%\r\n    - Rationale: Slight defensive tilt due to uncertainty\r\n\r\n    **Calculation:**\r\n    ```\r\n    weighted_score = (valuation * w_val) + (momentum * w_mom) + (quality * w_qual) + (growth * w_growth)\r\n    ```\r\n\r\n    If weighted_score > 0.3: Add +2% to baseline\r\n    If weighted_score > 0.5: Add +4% to baseline\r\n    If weighted_score < -0.2: Subtract -2% from baseline\r\n    If weighted_score < -0.4: Subtract -4% from baseline\r\n\r\n    ### Step 3: Risk Penalty Adjustments\r\n\r\n    Apply penalties for elevated risk factors:\r\n\r\n    **High Debt Risk (debt_risk = HIGH):**\r\n    - Penalty: -10% to -20% of expected return\r\n    - Rationale: Financial leverage amplifies downside in stressed markets\r\n    - Example: 12% baseline → 10% after -2% penalty\r\n\r\n    **Low Liquidity (liquidity_risk = HIGH):**\r\n    - Penalty: -5% to -15% of expected return\r\n    - Rationale: Illiquid stocks harder to exit, wider spreads\r\n\r\n    **High Volatility (volatility_level = HIGH):**\r\n    - Penalty: -5% of expected return\r\n    - Rationale: Higher risk requires margin of safety\r\n\r\n    **High Beta Risk (beta_risk = HIGH):**\r\n    - Penalty: -3% in LATE_CYCLE or RECESSION regimes only\r\n    - Rationale: Amplified downside when markets turn\r\n\r\n    **Missing Data (any factor score is null):**\r\n    - Penalty: -10% of expected return\r\n    - Reduce confidence by 0.10\r\n    - Rationale: Less information = more uncertainty\r\n\r\n    ### Step 4: Regime-Specific Adjustments\r\n\r\n    Further adjust based on macro regime:\r\n\r\n    **LATE_CYCLE (recession risk > 0.40):**\r\n    - Reduce expected returns by 20-30%\r\n    - Example: 12% → 8-10%\r\n    - Rationale: Capital preservation becomes priority\r\n\r\n    **RECESSION (recession risk > 0.60):**\r\n    - Reduce expected returns by 30-40%\r\n    - Example: 12% → 7-8%\r\n    - Focus on quality, avoid cyclicals\r\n\r\n    **EARLY_CYCLE (recession risk < 0.20):**\r\n    - Can use upper end of baseline ranges\r\n    - Rationale: Risk-on environment\r\n\r\n    **High VIX (> 30):**\r\n    - Reduce expected returns by 10-15%\r\n    - Increase uncertainty\r\n    - Rationale: Elevated market stress\r\n\r\n    **Inverted Yield Curve (< -50 bps):**\r\n    - Reduce expected returns by 5-10%\r\n    - Rationale: Recession leading indicator\r\n\r\n    ### Step 5: Sector Alignment Check\r\n\r\n    Check if stock's sector aligns with regime recommendations:\r\n\r\n    **Sector in recommended_overweights:**\r\n    - Boost: +1% to +2%\r\n    - Rationale: Regime favors this sector\r\n\r\n    **Sector in recommended_underweights:**\r\n    - Penalty: -2% to -3%\r\n    - Rationale: Regime headwinds for sector\r\n\r\n    **Sector valuation expensive + regime = LATE_CYCLE:**\r\n    - Extra penalty: -2%\r\n\r\n    ### Step 6: Confidence Calibration\r\n\r\n    Map signal confidence + adjustments to view confidence (0-1):\r\n\r\n    **HIGH confidence signal:**\r\n    - Base confidence: 0.80-0.95\r\n    - If all 4 factors aligned (all positive): 0.90-0.95\r\n    - If 3/4 factors aligned: 0.80-0.85\r\n    - If risk penalties applied: -0.05 to -0.10\r\n\r\n    **MEDIUM confidence signal:**\r\n    - Base confidence: 0.60-0.75\r\n    - If strong factor alignment: 0.70-0.75\r\n    - If weak factor alignment: 0.60-0.65\r\n    - If risk penalties applied: -0.05 to -0.10\r\n\r\n    **LOW confidence signal:**\r\n    - Base confidence: 0.40-0.60\r\n    - If some positive factors: 0.50-0.60\r\n    - If weak factors: 0.40-0.50\r\n    - If risk penalties applied: -0.05\r\n\r\n    **Missing data penalty:**\r\n    - Reduce confidence by 0.10 for each missing major factor score\r\n\r\n    **High regime uncertainty:**\r\n    - If regime = UNCERTAIN: -0.05 to -0.10 confidence\r\n\r\n    ### Step 7: View Uncertainty Calculation\r\n\r\n    Convert confidence to view uncertainty (standard deviation):\r\n\r\n    ```\r\n    view_uncertainty = base_uncertainty * (1 - confidence)\r\n    ```\r\n\r\n    Where base_uncertainty depends on volatility regime:\r\n    - Low volatility (< 20%): base = 0.10 (10%)\r\n    - Normal volatility (20-30%): base = 0.15 (15%)\r\n    - High volatility (> 30%): base = 0.20 (20%)\r\n\r\n    **Examples:**\r\n    - Confidence 0.80, normal vol: uncertainty = 0.15 * (1 - 0.80) = 0.03 (3%)\r\n    - Confidence 0.60, high vol: uncertainty = 0.20 * (1 - 0.60) = 0.08 (8%)\r\n    - Confidence 0.90, low vol: uncertainty = 0.10 * (1 - 0.90) = 0.01 (1%)\r\n\r\n    **Bounds:** Ensure 0.01 ≤ view_uncertainty ≤ 0.10\r\n\r\n    ### Step 8: Quality Checks\r\n\r\n    Before finalizing, verify:\r\n\r\n    - [ ] Expected return is reasonable: -30% to +30% annual\r\n    - [ ] Typical strong buy: 8-18% depending on regime\r\n    - [ ] Confidence is calibrated: HIGH signal → 0.75-0.95, MEDIUM → 0.50-0.75, LOW → 0.20-0.60\r\n    - [ ] View uncertainty makes sense: high confidence → low uncertainty (1-3%)\r\n    - [ ] Rationale mentions specific factors and regime considerations\r\n    - [ ] Risk adjustments are documented\r\n    - [ ] Regime alignment is checked\r\n    - [ ] If recession risk > 0.5, expected returns should be conservative (< 10%)\r\n\r\n    ### Step 9: Generate Structured Output\r\n\r\n    Provide:\r\n    - **expected_return**: Final calculated annual return (as decimal, e.g., 0.12)\r\n    - **confidence**: Final confidence level (0-1)\r\n    - **view_uncertainty**: Standard deviation of return forecast (as decimal, e.g., 0.03)\r\n    - **rationale**: 2-3 sentences explaining the view\r\n    - **factor_contributions**: Breakdown of factor impacts (e.g., \"Momentum +3%, Quality +2%\")\r\n    - **risk_adjustments**: List of penalties applied (e.g., \"High debt: -2%, High vol: -1%\")\r\n    - **regime_adjustment**: How regime affected the view (e.g., \"Late cycle: reduced return by 3%\")\r\n\r\n    ## Important Guidelines\r\n\r\n    - **Be conservative:** When in doubt, lower expected returns and reduce confidence\r\n    - **Be quantitative:** Provide specific numerical adjustments, not vague statements\r\n    - **Be consistent:** Similar signals should produce similar views\r\n    - **Be explainable:** Rationale should be clear and reference specific inputs\r\n    - **Respect regime:** Late cycle / recession should produce more conservative views\r\n    - **Mind the risks:** Don't ignore debt, liquidity, or volatility warnings\r\n    - **Calibrate confidence:** Don't over-confidence views; market is uncertain\r\n    - **Use upside_potential_pct as a sanity check:** If it says +5%, don't forecast +20%\r\n\r\n    ## Example Reasoning Process\r\n\r\n    \"Given LARGE_GAIN signal with HIGH confidence, I start with 14% baseline. The stock has\r\n    strong momentum (0.73) and quality (0.61) scores, adding +3%. However, it has HIGH debt\r\n    risk, applying -2% penalty. The late-cycle regime with 52% recession risk warrants\r\n    reducing the return by 25%, bringing it to 11.25%. The sector (Technology) is in the\r\n    regime's recommended overweights, adding +1%. Final view: 12.3% expected return with\r\n    0.78 confidence (reduced from 0.85 due to debt risk). View uncertainty of 2.2% reflects\r\n    the high confidence tempered by late-cycle macro uncertainty.\"\r\n  \"#\r\n}\r\n",
    "clients.baml": "// Learn more about clients at https://docs.boundaryml.com/docs/snippets/clients/overview\n\nclient<llm> AzureOpenAIGpt4o {\n  provider azure-openai\n  options {\n    resource_name env.OPENAI_RESOURCE_NAME\n    deployment_id env.OPENAI_GPT4O_DEPLOYMENT_ID\n    api_version env.OPENAI_API_VERSION\n    api_key env.OPENAI_KEY\n    temperature 0.0\n  }\n}\n\nclient<llm> AzureOpenAIGpt5 {\n  provider azure-openai\n  options {\n    resource_name env.OPENAI_RESOURCE_NAME\n    deployment_id env.OPENAI_GPT5_DEPLOYMENT_ID\n    api_version env.OPENAI_API_VERSION\n    api_key env.OPENAI_KEY\n    max_tokens null\n    }\n}\n// https://docs.boundaryml.com/docs/snippets/clients/retry\nretry_policy Constant {\n  max_retries 3\n  // Strategy is optional\n  strategy {\n    type constant_delay\n    delay_ms 200\n  }\n}\n\nretry_policy Exponential {\n  max_retries 2\n  // Strategy is optional\n  strategy {\n    type exponential_backoff\n    delay_ms 300\n    multiplier 1.5\n    max_delay_ms 10000\n  }\n}",
    "comprehensive_stock_data.baml": "// ============================================================================\n// COMPREHENSIVE YFINANCE STOCK DATA TYPES\n// All field names match exactly with yfinance API\n// Based on yfinance_metadata_report.txt analysis\n// ============================================================================\n\n// ============================================================================\n// 1. CORE PRICE & VALUATION DATA (34 fields from yfinance)\n// ============================================================================\n\nclass YFinancePriceData {\n  // Current Price Data\n  currentPrice float?\n  regularMarketPrice float?\n  regularMarketOpen float?\n  open float?\n  previousClose float?\n  regularMarketPreviousClose float?\n\n  // Intraday Range\n  dayHigh float?\n  dayLow float?\n  regularMarketDayHigh float?\n  regularMarketDayLow float?\n  regularMarketDayRange string?\n\n  // 52-Week Range\n  fiftyTwoWeekHigh float?\n  fiftyTwoWeekLow float?\n  fiftyTwoWeekHighChange float?\n  fiftyTwoWeekLowChange float?\n  fiftyTwoWeekHighChangePercent float?\n  fiftyTwoWeekLowChangePercent float?\n  fiftyTwoWeekRange string?\n  fiftyTwoWeekChangePercent float?  // 52WeekChange from yfinance\n\n  // All-Time Highs/Lows\n  allTimeHigh float?\n  allTimeLow float?\n\n  // Bid/Ask\n  bid float?\n  ask float?\n  bidSize int?\n  askSize int?\n\n  // Market Changes\n  regularMarketChange float?\n  regularMarketChangePercent float?\n\n  // Post-Market (if available)\n  postMarketPrice float?\n  postMarketChange float?\n  postMarketChangePercent float?\n  postMarketTime int?\n\n  // Analyst Targets\n  targetMeanPrice float?\n  targetMedianPrice float?\n  targetHighPrice float?\n  targetLowPrice float?\n\n  // Valuation Ratios\n  priceToBook float?\n  priceToSalesTrailing12Months float?\n  priceEpsCurrentYear float?\n\n  // Other\n  priceHint int?\n  customPriceAlertConfidence string?\n}\n\n// ============================================================================\n// 2. FINANCIAL METRICS (28 fields from yfinance)\n// ============================================================================\n\nclass YFinanceFinancialMetrics {\n  // Profitability Ratios\n  profitMargins float?\n  grossMargins float?\n  operatingMargins float?\n  ebitdaMargins float?\n\n  // Efficiency Metrics\n  returnOnAssets float?\n  returnOnEquity float?\n\n  // Growth Metrics\n  revenueGrowth float?\n  earningsGrowth float?\n  earningsQuarterlyGrowth float?\n\n  // Liquidity Ratios\n  currentRatio float?\n  quickRatio float?\n\n  // Leverage\n  debtToEquity float?\n\n  // Dividend Metrics\n  payoutRatio float?\n\n  // Absolute Financials\n  grossProfits float?\n  totalRevenue float?\n  revenuePerShare float?\n  netIncomeToCommon float?\n  totalCash float?\n  totalCashPerShare float?\n  totalDebt float?\n\n  // Cash Flow\n  operatingCashflow float?\n  freeCashflow float?\n\n  // Valuation\n  enterpriseToRevenue float?\n\n  // Short Interest\n  shortRatio float?\n\n  // Earnings Timing\n  earningsTimestampStart int?\n  earningsTimestampEnd int?\n  earningsTimestamp int?\n  earningsCallTimestampStart int?\n  earningsCallTimestampEnd int?\n  isEarningsDateEstimate bool?\n\n  // Other\n  trailingPegRatio float?\n}\n\n// ============================================================================\n// 3. DIVIDEND & YIELD DATA (9 fields from yfinance)\n// ============================================================================\n\nclass YFinanceDividendData {\n  dividendYield float?\n  dividendRate float?\n  trailingAnnualDividendRate float?\n  trailingAnnualDividendYield float?\n  fiveYearAvgDividendYield float?\n\n  // Dividend Dates\n  dividendDate int?  // Unix timestamp\n  exDividendDate int?\n  lastDividendDate int?\n  lastDividendValue float?\n}\n\n// ============================================================================\n// 4. COMPANY INFORMATION (20 fields from yfinance)\n// ============================================================================\n\nclass YFinanceCompanyInfo {\n  // Identifiers\n  symbol string?\n  shortName string?\n  longName string?\n  displayName string?\n\n  // Classification\n  sector string?\n  sectorDisp string?\n  sectorKey string?\n  industry string?\n  industryDisp string?\n  industryKey string?\n\n  // Location\n  country string?\n  state string?\n  city string?\n  zip string?\n  address1 string?\n  address2 string?\n\n  // Contact\n  phone string?\n  website string?\n  irWebsite string?\n\n  // Description\n  longBusinessSummary string?\n\n  // Exchange Info\n  exchange string?\n  fullExchangeName string?\n  quoteSourceName string?\n  exchangeTimezoneName string?\n  exchangeTimezoneShortName string?\n\n  // Employees\n  fullTimeEmployees int?\n}\n\n// ============================================================================\n// 5. OFFICERS & GOVERNANCE (6 fields from yfinance)\n// ============================================================================\n\nclass YFinanceGovernance {\n  // Officers (list of dicts with name, title, age, etc)\n  companyOfficers string?  // JSON string of officer list\n  executiveTeam string?    // JSON string of executive data\n\n  // Governance Scores\n  boardRisk int?\n  compensationRisk int?\n  overallRisk int?\n  shareHolderRightsRisk int?\n  auditRisk int?\n\n  // Compensation Date\n  compensationAsOfEpochDate int?\n  governanceEpochDate int?\n\n  // Communication\n  messageBoardId string?\n}\n\n// ============================================================================\n// 6. MARKET DATA & VOLUME (25 fields from yfinance)\n// ============================================================================\n\nclass YFinanceMarketData {\n  // Market Cap & Shares\n  marketCap float?\n  sharesOutstanding float?\n  impliedSharesOutstanding float?\n  floatShares float?\n\n  // Volume\n  volume float?\n  regularMarketVolume float?\n  averageVolume float?\n  averageVolume10days float?\n  averageDailyVolume10Day float?\n  averageDailyVolume3Month float?\n\n  // Short Interest\n  sharesShort float?\n  sharesShortPriorMonth float?\n  shortPercentOfFloat float?\n  sharesPercentSharesOut float?\n  sharesShortPreviousMonthDate int?\n  dateShortInterest int?\n\n  // Institutional Holdings\n  heldPercentInstitutions float?\n  heldPercentInsiders float?\n\n  // Market Info\n  market string?\n  marketState string?\n  hasPrePostMarketData bool?\n\n  // Timing\n  regularMarketTime int?\n  gmtOffSetMilliseconds int?\n\n  // Other\n  corporateActions string?  // JSON string\n}\n\n// ============================================================================\n// 7. TRADING INFO (6 fields from yfinance)\n// ============================================================================\n\nclass YFinanceTradingInfo {\n  currency string?\n  financialCurrency string?\n  exchange string?\n  exchangeDataDelayedBy int?\n  tradeable bool?\n  cryptoTradeable bool?\n}\n\n// ============================================================================\n// 8. ANALYST RECOMMENDATIONS (4 fields from yfinance)\n// ============================================================================\n\nclass YFinanceAnalystData {\n  recommendationKey string?  // \"buy\", \"strong_buy\", \"hold\", \"sell\", \"strong_sell\"\n  recommendationMean float?  // 1.0 (Strong Buy) to 5.0 (Strong Sell)\n  numberOfAnalystOpinions int?\n  averageAnalystRating string?\n}\n\n// ============================================================================\n// 9. DATES & TIME (7 fields from yfinance)\n// ============================================================================\n\nclass YFinanceDates {\n  firstTradeDateMilliseconds int?\n  lastFiscalYearEnd int?\n  nextFiscalYearEnd int?\n  mostRecentQuarter int?\n  lastSplitDate int?\n  lastSplitFactor string?\n  ipoExpectedDate int?\n}\n\n// ============================================================================\n// 10. TECHNICAL & OTHER (46 fields from yfinance)\n// ============================================================================\n\nclass YFinanceTechnicalData {\n  // Moving Averages\n  fiftyDayAverage float?\n  twoHundredDayAverage float?\n  fiftyDayAverageChange float?\n  twoHundredDayAverageChange float?\n  fiftyDayAverageChangePercent float?\n  twoHundredDayAverageChangePercent float?\n\n  // Beta\n  beta float?\n\n  // Performance vs S&P 500\n  SandP52WeekChange float?  // Exact field name with capital S and P\n\n  // EPS Data\n  epsTrailingTwelveMonths float?\n  epsCurrentYear float?\n  epsForward float?\n  forwardEps float?\n  trailingEps float?\n\n  // P/E Ratios\n  trailingPE float?\n  forwardPE float?\n\n  // Book Value\n  bookValue float?\n\n  // EBITDA & Enterprise Value\n  ebitda float?\n  enterpriseValue float?\n  enterpriseToEbitda float?\n\n  // ESG\n  esgPopulated bool?\n\n  // Quote Metadata\n  quoteType string?\n  typeDisp string?\n  language string?\n  region string?\n  maxAge int?\n  sourceInterval int?\n  triggerable bool?\n\n  // Other\n  fax string?\n}\n\n// ============================================================================\n// COMPLETE YFINANCE STOCK DATA (ALL CATEGORIES COMBINED)\n// ============================================================================\n\nclass ComprehensiveYFinanceData {\n  // Identifiers (required)\n  ticker string\n  company_name string\n\n  // All yfinance categories (all optional since availability varies)\n  price_data YFinancePriceData?\n  financial_metrics YFinanceFinancialMetrics?\n  dividend_data YFinanceDividendData?\n  company_info YFinanceCompanyInfo?\n  governance YFinanceGovernance?\n  market_data YFinanceMarketData?\n  trading_info YFinanceTradingInfo?\n  analyst_data YFinanceAnalystData?\n  dates YFinanceDates?\n  technical_data YFinanceTechnicalData?\n\n  // Metadata\n  data_fetch_timestamp string\n  data_completeness_pct float  // Percentage of fields populated\n  yfinance_info_dict_size int  // Number of fields in raw yfinance info dict\n}\n\n// ============================================================================\n// MINIMAL DATA FOR QUICK SCREENING\n// ============================================================================\n\nclass MinimalYFinanceData {\n  // Core identifiers\n  ticker string\n  company_name string\n  sector string?\n  industry string?\n\n  // Essential price/valuation\n  currentPrice float?\n  marketCap float?\n  volume float?\n\n  // Key ratios (most stocks have these)\n  trailingPE float?\n  priceToBook float?\n  returnOnEquity float?\n  debtToEquity float?\n  profitMargins float?\n\n  // Growth\n  revenueGrowth float?\n  earningsGrowth float?\n\n  // Performance\n  fiftyTwoWeekChangePercent float?\n  beta float?\n\n  // Analyst consensus\n  recommendationKey string?\n}\n\n// ============================================================================\n// HISTORICAL PRICE DATA (OHLCV)\n// ============================================================================\n\nclass HistoricalPriceData {\n  // Time series data (parallel arrays)\n  dates string[]  // ISO date strings\n  open float[]\n  high float[]\n  low float[]\n  close float[]\n  adj_close float[]  // Adjusted for splits/dividends\n  volume float[]\n\n  // Metadata\n  ticker string\n  start_date string\n  end_date string\n  trading_days_count int\n  data_quality_score float  // 0-1, based on completeness\n}\n\n// ============================================================================\n// FINANCIAL STATEMENTS (from yfinance financials API)\n// ============================================================================\n\nclass YFinanceIncomeStatement {\n  periods string[]  // Quarter labels e.g., [\"2024-09-30\", \"2024-06-30\"]\n\n  // Revenue\n  TotalRevenue float[]?\n  CostOfRevenue float[]?\n  GrossProfit float[]?\n\n  // Operating\n  OperatingExpense float[]?\n  OperatingIncome float[]?\n  EBITDA float[]?\n\n  // Net Income\n  NetIncome float[]?\n  NetIncomeCommonStockholders float[]?\n\n  // Per Share\n  BasicEPS float[]?\n  DilutedEPS float[]?\n\n  // Other\n  ResearchAndDevelopment float[]?\n  SellingGeneralAndAdministration float[]?\n  InterestExpense float[]?\n  TaxProvision float[]?\n}\n\nclass YFinanceBalanceSheet {\n  periods string[]\n\n  // Assets\n  TotalAssets float[]?\n  CurrentAssets float[]?\n  CashAndCashEquivalents float[]?\n  CashCashEquivalentsAndShortTermInvestments float[]?\n  AccountsReceivable float[]?\n  Inventory float[]?\n  PropertyPlantEquipment float[]?\n  Goodwill float[]?\n  IntangibleAssets float[]?\n\n  // Liabilities\n  TotalLiabilities float[]?\n  CurrentLiabilities float[]?\n  AccountsPayable float[]?\n  ShortTermDebt float[]?\n  LongTermDebt float[]?\n  TotalDebt float[]?\n\n  // Equity\n  StockholdersEquity float[]?\n  RetainedEarnings float[]?\n  TreasuryStock float[]?\n\n  // Shares\n  ShareIssued float[]?\n  OrdinarySharesNumber float[]?\n}\n\nclass YFinanceCashFlow {\n  periods string[]\n\n  // Operating Activities\n  OperatingCashFlow float[]?\n  CashFlowFromContinuingOperatingActivities float[]?\n  DepreciationAndAmortization float[]?\n  ChangeInWorkingCapital float[]?\n\n  // Investing Activities\n  CashFlowFromInvestingActivities float[]?\n  CapitalExpenditure float[]?\n  NetBusinessPurchaseAndSale float[]?\n  NetInvestmentPurchaseAndSale float[]?\n\n  // Financing Activities\n  CashFlowFromFinancingActivities float[]?\n  RepurchaseOfCapitalStock float[]?\n  RepaymentOfDebt float[]?\n  IssuanceOfDebt float[]?\n  CashDividendsPaid float[]?\n\n  // Free Cash Flow (derived)\n  FreeCashFlow float[]?\n}\n\n// ============================================================================\n// COMPLETE FINANCIAL STATEMENTS BUNDLE\n// ============================================================================\n\nclass YFinanceFinancialStatements {\n  ticker string\n  income_statement YFinanceIncomeStatement?\n  balance_sheet YFinanceBalanceSheet?\n  cash_flow YFinanceCashFlow?\n\n  // Metadata\n  statement_frequency string  // \"quarterly\" or \"annual\"\n  most_recent_period string\n  periods_available int\n}\n",
    "cycle_classifier.baml": "enum BusinessCycleRegime {\n  EARLY_CYCLE\n  MID_CYCLE\n  LATE_CYCLE\n  RECESSION\n  UNCERTAIN\n}\n\nenum ISMSignal {\n  STRONG_EXPANSION // >52\n  MILD_EXPANSION // 50-52\n  MILD_CONTRACTION // 45-50\n  DEEP_CONTRACTION // <45\n}\n\nenum YieldCurveSignal {\n  STEEP // >100bps\n  NORMAL // 50-100bps\n  FLAT // 0-50bps\n  INVERTED // <0bps\n}\n\nenum CreditSpreadSignal {\n  TIGHT // <350bps\n  NEUTRAL // 350-500bps\n  WIDENING // 500-700bps\n  STRESS // >700bps\n}\n\nenum FactorExposure {\n  GROWTH_MOMENTUM\n  QUALITY_DEFENSIVE\n  BALANCED\n}\n\nclass EconomicIndicators {\n  // GDP Indicators (from Il Sole + Trading Economics)\n  gdp_growth_qq float?  // Quarterly growth rate\n  gdp_growth_yy float?  // Year-over-year growth rate\n  gdp_forecast_6m float?  // 6-month forecast\n\n  // Labor Market\n  unemployment float?  // Unemployment rate (%)\n\n  // Production & Capacity\n  industrial_production float?  // Industrial production growth (%)\n  capacity_utilization float?  // Capacity utilization (%)\n\n  // Inflation & Prices\n  inflation float?  // Headline inflation rate (%)\n  inflation_mom float?  // Month-over-month inflation (%)\n  core_inflation float?  // Core inflation rate (%)\n  inflation_forecast float?  // Inflation forecast\n\n  // Consumption & Retail\n  retail_sales_mom float?  // Retail sales month-over-month growth (%)\n\n  // Corporate & Earnings\n  earnings_growth_forecast float?  // Earnings growth forecast (%)\n\n  // Confidence Indicators\n  business_confidence float?  // Business confidence index\n  consumer_confidence float?  // Consumer confidence index\n\n  // External & Trade\n  trade_balance float?  // Trade balance (USD billions)\n  current_account float?  // Current account balance (USD billions)\n  current_account_gdp float?  // Current account as % of GDP\n\n  // Fiscal Position\n  government_debt_gdp float?  // Government debt as % of GDP\n  budget_balance_gdp float?  // Budget balance as % of GDP\n}\n\nclass MarketIndicators {\n  // PMI Indicators (Manufacturing Activity)\n  ism_pmi float?  // US ISM PMI (global proxy from FRED)\n  manufacturing_pmi float?  // Country-specific manufacturing PMI\n  services_pmi float?  // Services sector PMI\n  composite_pmi float?  // Composite PMI (both manufacturing & services)\n\n  // Interest Rates & Policy\n  interest_rate float?  // Central bank policy rate (%)\n\n  // Yield Curve & Bond Markets\n  yield_curve_2s10s float?  // 10Y-2Y treasury spread (basis points)\n  bond_yield_2y float?  // 2-year government bond yield (%)\n  bond_yield_5y float?  // 5-year government bond yield (%)\n  bond_yield_10y float?  // 10-year government bond yield (%)\n  bond_yield_30y float?  // 30-year government bond yield (%)\n\n  // Credit Markets & Risk\n  hy_spread float?  // High-yield credit spread (basis points)\n\n  // Volatility & Sentiment\n  vix float?  // VIX volatility index\n  vix_signal string?  // VIX regime classification\n}\n\nclass BusinessCycleClassification {\n  // Core Classification\n  regime BusinessCycleRegime\n\n  confidence float\n  @description(#\"\n    0.0 to 1.0\n  \"#)\n\n  rationale string\n  @description(#\"\n    Concise explanation (2-3 sentences maximum)\n  \"#)\n\n  // Key Decision Indicators (simplified signals)\n  ism_signal ISMSignal\n  yield_curve_signal YieldCurveSignal\n  credit_spread_signal CreditSpreadSignal\n\n  // Recession Risk Assessment\n  recession_risk_6m float\n  @description(#\"\n    0.0 to 1.0\n  \"#)\n\n  recession_risk_12m float\n  @description(#\"\n    0.0 to 1.0\n  \"#)\n\n  recession_drivers string[]\n  @description(#\"\n    2-4 key recession risk factors\n  \"#)\n\n  // Portfolio Positioning (ACTIONABLE - directly usable)\n  sector_tilts map<string, float>\n  @description(#\"\n    Sector -> weight adjustment between -0.10 and +0.10\n  \"#)\n\n  recommended_overweights string[]\n  @description(#\"\n    3-5 sectors to overweight with brief rationale\n  \"#)\n\n  recommended_underweights string[]\n  @description(#\"\n    3-5 sectors to underweight with brief rationale\n  \"#)\n\n  factor_exposure FactorExposure\n\n  // Risk Monitoring\n  primary_risks string[]\n  @description(#\"\n    2-3 main risks to watch\n  \"#)\n\n  conflicting_signals string[]\n  @description(#\"\n    Any major contradictions (empty if none)\n  \"#)\n}\n\nfunction ClassifyBusinessCycleWithLLM(\n  today: string,\n  economic_indicators: EconomicIndicators,\n  market_indicators: MarketIndicators,\n  news_signals: MacroNewsSignals,\n  country: string\n) -> BusinessCycleClassification {\n  client AzureOpenAIGpt5\n\n  prompt #\"\n    {{ _.role(\"system\") }}\n    You are an expert macroeconomic strategist with 15+ years of experience in business cycle analysis and portfolio construction. Your specialty is synthesizing multi-source economic data into actionable investment insights.\n\n    Your core competencies:\n    - Pattern recognition across historical business cycles\n    - Data-driven regime classification using quantitative frameworks\n    - Risk assessment through leading and coincident indicator analysis\n    - Sector rotation strategies aligned with macroeconomic phases\n\n    Your analytical approach is systematic, evidence-based, and grounded in economic theory. You prioritize country-specific data over global proxies and always quantify confidence levels based on signal alignment.\n\n    {{ _.role(\"user\") }}\n    # OBJECTIVE\n    Classify the current business cycle regime for {{ country }} using a structured analytical framework. Provide high-confidence classification with actionable portfolio positioning recommendations.\n\n    **Analysis Date:** {{ today }}\n\n    ---\n\n    # INPUT DATA HIERARCHY\n\n    ## PRIMARY SOURCE: Country-Specific Economic Indicators ({{ country }})\n    **GDP Growth**\n    - Quarter-over-Quarter: {{ economic_indicators.gdp_growth_qq }}%\n    - Year-over-Year: {{ economic_indicators.gdp_growth_yy }}%\n    - 6-Month Forecast: {{ economic_indicators.gdp_forecast_6m }}%\n\n    **Labor Market**\n    - Unemployment Rate: {{ economic_indicators.unemployment }}%\n\n    **Production & Capacity**\n    - Industrial Production Growth: {{ economic_indicators.industrial_production }}%\n    - Capacity Utilization: {{ economic_indicators.capacity_utilization }}%\n\n    **Inflation & Prices**\n    - Headline Inflation: {{ economic_indicators.inflation }}%\n    - Inflation MoM: {{ economic_indicators.inflation_mom }}%\n    - Core Inflation: {{ economic_indicators.core_inflation }}%\n    - Inflation Forecast (6M): {{ economic_indicators.inflation_forecast }}%\n\n    **Consumption & Retail**\n    - Retail Sales MoM: {{ economic_indicators.retail_sales_mom }}%\n\n    **Corporate Earnings**\n    - Earnings Growth Forecast: {{ economic_indicators.earnings_growth_forecast }}%\n\n    **Confidence Indicators**\n    - Business Confidence: {{ economic_indicators.business_confidence }}\n    - Consumer Confidence: {{ economic_indicators.consumer_confidence }}\n\n    **External Balance & Trade**\n    - Trade Balance: {{ economic_indicators.trade_balance }} USD billions\n    - Current Account: {{ economic_indicators.current_account }} USD billions\n    - Current Account (% GDP): {{ economic_indicators.current_account_gdp }}%\n\n    **Fiscal Position**\n    - Government Debt (% GDP): {{ economic_indicators.government_debt_gdp }}%\n    - Budget Balance (% GDP): {{ economic_indicators.budget_balance_gdp }}%\n\n    ---\n\n    ## SECONDARY SOURCE: Market Indicators (Global Context & Confirmation)\n    **PMI Indicators (Manufacturing & Services Activity)**\n    - ISM PMI (US proxy): {{ market_indicators.ism_pmi }}\n      └─ Classification: >52 (expansion) | 50-52 (neutral) | 45-50 (mild contraction) | <45 (deep contraction)\n    - Manufacturing PMI ({{ country }}): {{ market_indicators.manufacturing_pmi }}\n    - Services PMI ({{ country }}): {{ market_indicators.services_pmi }}\n    - Composite PMI ({{ country }}): {{ market_indicators.composite_pmi }}\n\n    **Interest Rates & Monetary Policy**\n    - Central Bank Policy Rate: {{ market_indicators.interest_rate }}%\n\n    **Yield Curve & Government Bonds**\n    - Yield Curve Spread (10Y-2Y): {{ market_indicators.yield_curve_2s10s }} basis points\n      └─ Classification: >100bps (steep/accommodative) | 50-100bps (normal) | 0-50bps (flat/caution) | <0bps (inverted/recession warning)\n    - 2-Year Bond Yield: {{ market_indicators.bond_yield_2y }}%\n    - 5-Year Bond Yield: {{ market_indicators.bond_yield_5y }}%\n    - 10-Year Bond Yield: {{ market_indicators.bond_yield_10y }}%\n    - 30-Year Bond Yield: {{ market_indicators.bond_yield_30y }}%\n\n    **Credit Markets & Risk**\n    - High-Yield Credit Spread: {{ market_indicators.hy_spread }} basis points\n      └─ Classification: <350bps (tight/optimistic) | 350-500bps (neutral) | 500-700bps (widening/stress) | >700bps (severe stress)\n\n    **Volatility & Market Sentiment**\n    - VIX Level: {{ market_indicators.vix }} ({{ market_indicators.vix_signal }})\n\n    ## TERTIARY SOURCE: News Sentiment & Narrative Analysis\n    **Thematic Trends**: {{ news_signals.dominant_themes | join(', ') }}\n\n    **Economic Sentiment Breakdown**\n    - Growth Outlook: {{ news_signals.growth_sentiment }} - {{ news_signals.growth_summary }}\n    - Inflation Expectations: {{ news_signals.inflation_sentiment }} - {{ news_signals.inflation_summary }}\n    - Labor Market Sentiment: {{ news_signals.labor_market_sentiment }} - {{ news_signals.labor_market_summary }}\n\n    **Policy & Risk**\n    - Central Bank Policy Stance: {{ news_signals.policy_stance }} - {{ news_signals.policy_summary }}\n    - Market Risk Appetite: {{ news_signals.risk_appetite }}\n\n    **Regime Narrative**: {{ news_signals.regime_narrative }} - {{ news_signals.regime_rationale }}\n\n    ---\n\n    # BUSINESS CYCLE CLASSIFICATION FRAMEWORK\n\n    ## Regime Definitions & Characteristics\n\n    ### EARLY_CYCLE\n    **Economic Characteristics:**\n    - GDP accelerating from trough (QQ growth turning positive and rising)\n    - Unemployment rate declining from peak levels\n    - Industrial production rebounding strongly (>3% YY)\n    - ISM PMI expanding (>52)\n    - Earnings growth expectations improving sharply\n\n    **Market Characteristics:**\n    - Yield curve steep (>100bps) - accommodative monetary policy\n    - Credit spreads tightening from stressed levels (<350bps)\n    - VIX declining from elevated levels\n    - Risk appetite increasing\n\n    **Typical Duration:** 6-12 months post-recession trough\n\n    ### MID_CYCLE\n    **Economic Characteristics:**\n    - GDP growth steady and moderate (2.0-3.5% annualized)\n    - Unemployment rate stable in healthy range (4.0-5.5%)\n    - Moderate inflation (1.5-3.0%)\n    - ISM PMI in expansion zone but not overheated (50-55)\n    - Balanced economic conditions with no major imbalances\n\n    **Market Characteristics:**\n    - Yield curve normal slope (50-100bps)\n    - Credit spreads neutral (350-500bps)\n    - Volatility subdued (VIX 12-20)\n    - Steady risk appetite\n\n    **Typical Duration:** 18-36 months - longest phase of cycle\n\n    ### LATE_CYCLE\n    **Economic Characteristics:**\n    - GDP growth decelerating (slowing QQ growth rates)\n    - Unemployment at cycle lows (<4.0%) - tight labor market\n    - Inflation pressures building or elevated (>3.0%)\n    - ISM PMI falling toward 50 or below\n    - Tightening financial conditions\n    - Earnings growth forecasts declining\n\n    **Market Characteristics:**\n    - Yield curve flattening or inverted (<50bps or negative)\n    - Credit spreads beginning to widen (>500bps)\n    - Volatility rising (VIX >20)\n    - Risk appetite deteriorating\n    - Central bank in tightening mode or pausing after hikes\n\n    **Typical Duration:** 6-18 months before recession\n\n    ### RECESSION\n    **Economic Characteristics:**\n    - GDP growth negative (two consecutive quarters typical)\n    - Unemployment rising (typically >6.5% and increasing)\n    - Industrial production contracting (negative YY growth)\n    - ISM PMI in deep contraction (<45)\n    - Earnings declining broadly\n\n    **Market Characteristics:**\n    - Credit spreads wide and volatile (>500bps, often >700bps)\n    - VIX elevated (>30)\n    - Significant market stress and risk-off sentiment\n    - Central bank easing aggressively\n\n    **Typical Duration:** 6-18 months\n\n    ### UNCERTAIN\n    **When to Use:**\n    - Conflicting signals across data sources (e.g., strong GDP but contracting PMI)\n    - Transition periods between regimes with ambiguous data\n    - Data quality issues or missing critical indicators\n    - Confidence score would be <0.60 for any single regime\n    - Major structural changes making historical patterns unreliable\n\n    ---\n\n    # ANALYTICAL REASONING FRAMEWORK\n\n    Use this systematic chain-of-thought process. **Document your reasoning explicitly for each step.**\n\n    ## STEP 1: DATA QUALITY & SIGNAL EXTRACTION\n\n    **Task:** Extract and classify all available signals according to the framework.\n\n    ### 1A. Classify Market Indicators\n    - ISM PMI {{ market_indicators.ism_pmi }} → Classify as: STRONG_EXPANSION (>52) | MILD_EXPANSION (50-52) | MILD_CONTRACTION (45-50) | DEEP_CONTRACTION (<45)\n    - Yield Curve {{ market_indicators.yield_curve_2s10s }}bps → Classify as: STEEP (>100) | NORMAL (50-100) | FLAT (0-50) | INVERTED (<0)\n    - Credit Spread {{ market_indicators.hy_spread }}bps → Classify as: TIGHT (<350) | NEUTRAL (350-500) | WIDENING (500-700) | STRESS (>700)\n\n    ### 1B. Assess Data Availability & Quality\n    - Which indicators are missing or null? List any gaps.\n    - Are there data inconsistencies or outliers that need special consideration?\n\n    ### 1C. Extract Key Metrics from Country-Specific Data\n    From the Economic and Market Indicators, identify:\n    - Most recent PMI readings (Manufacturing, Services, Composite)\n    - Business/Consumer Confidence trends (rising, falling, stable)\n    - Bond yield curve shape (use actual {{ country }} government bonds: 2Y, 5Y, 10Y, 30Y)\n    - Retail sales growth trajectory\n    - Employment/unemployment trends\n    - Industrial production & capacity utilization\n    - Trade balance and fiscal position\n\n    **Output for Step 1:** List the classified signals and note data quality.\n\n    ---\n\n    ## STEP 2: REGIME PATTERN MATCHING\n\n    **Task:** Compare observed data patterns against each regime definition. Use weighted scoring.\n\n    ### 2A. Scoring Weights by Data Source Priority\n    Apply these weights when evaluating regime fit:\n    - **Country-specific economic indicators (GDP, unemployment, inflation, trade, fiscal):** 50% weight\n    - **Country-specific market indicators (PMI, bond yields, confidence):** 30% weight\n    - **Global market indicators (ISM, HY spreads, VIX):** 15% weight\n    - **News sentiment:** 5% weight\n\n    ### 2B. Pattern Matching Analysis\n    For each regime (EARLY_CYCLE, MID_CYCLE, LATE_CYCLE, RECESSION), evaluate:\n\n    **EARLY_CYCLE Pattern Match:**\n    - Is GDP growth accelerating from low levels? (Check QQ vs YY growth trends)\n    - Is ISM >52 in expansion?\n    - Is yield curve steep (>100bps)?\n    - Are credit spreads tight (<350bps)?\n    - Is unemployment declining?\n    - Are earnings forecasts improving?\n    - What is the overall pattern match score (0-100)?\n\n    **MID_CYCLE Pattern Match:**\n    - Is GDP growth stable in 2-3.5% range?\n    - Is ISM in 50-55 range?\n    - Is yield curve normal (50-100bps)?\n    - Are credit spreads neutral (350-500bps)?\n    - Is unemployment stable in healthy range (4-5.5%)?\n    - Are conditions balanced without major imbalances?\n    - What is the overall pattern match score (0-100)?\n\n    **LATE_CYCLE Pattern Match:**\n    - Is GDP growth decelerating (compare current to 6M forecast)?\n    - Is ISM falling toward/below 50?\n    - Is yield curve flat/inverted (<50bps)?\n    - Are credit spreads widening (>500bps)?\n    - Is unemployment at cycle lows (<4%)?\n    - Is inflation elevated (>3%)?\n    - Are financial conditions tightening?\n    - What is the overall pattern match score (0-100)?\n\n    **RECESSION Pattern Match:**\n    - Is GDP growth negative?\n    - Is ISM <45 in deep contraction?\n    - Is unemployment >6.5% and rising?\n    - Are credit spreads in stress territory (>500bps)?\n    - Are earnings declining?\n    - Is VIX elevated (>30)?\n    - What is the overall pattern match score (0-100)?\n\n    ### 2C. Identify Conflicting Signals\n    - List any indicators that contradict the highest-scoring regime\n    - Assess whether contradictions are minor (lagging indicators) or major (leading indicators diverging)\n\n    **Output for Step 2:** Rank regimes by pattern match score. Identify the leading candidate and note any significant conflicting signals.\n\n    ---\n\n    ## STEP 3: CONFIDENCE CALIBRATION\n\n    **Task:** Quantify confidence level based on signal alignment and data quality.\n\n    ### 3A. Calculate Base Confidence\n    Use this calibration rubric:\n\n    **High Confidence (0.85-1.0):**\n    - All primary indicators (GDP, unemployment, industrial production, comprehensive PMI data) align with single regime\n    - Market indicators (ISM, yield curve, credit spreads) confirm the same regime\n    - News sentiment supports the classification\n    - No major conflicting signals\n    - Regime is clearly established (not in transition)\n\n    **Moderate-High Confidence (0.70-0.85):**\n    - Most primary indicators align with single regime\n    - 1-2 minor contradictions from lagging or less critical indicators\n    - Market indicators mostly confirm\n    - Regime is likely but may be in early transition phase\n\n    **Mixed Confidence (0.60-0.70):**\n    - Primary indicators show mixed signals\n    - 2-3 significant contradictions between leading indicators\n    - Market indicators diverge from economic indicators\n    - Possible transition period between regimes\n    - Consider UNCERTAIN regime classification\n\n    **Low Confidence (<0.60):**\n    - Major contradictions across data sources\n    - Missing critical data points\n    - Structural changes making historical patterns unreliable\n    - **MUST classify as UNCERTAIN regime**\n\n    ### 3B. Adjust for Data Quality\n    - Reduce confidence by 0.05-0.15 if multiple critical indicators (GDP, unemployment, PMI) are null\n    - Reduce confidence by 0.10 if major conflicting signals exist between leading indicators\n    - Reduce confidence by 0.05 if country-specific data (PMI, confidence indices) is missing\n\n    ### 3C. Adjust for Regime Characteristics\n    - Mid-cycle classifications: Can achieve confidence up to 0.95 (most stable regime)\n    - Early-cycle classifications: Cap confidence at 0.90 (transition from recession is volatile)\n    - Late-cycle classifications: Cap confidence at 0.85 (most uncertain/complex phase)\n    - Recession classifications: Can achieve 0.95 if data clearly negative across board\n\n    **Output for Step 3:** Final confidence score with justification.\n\n    ---\n\n    ## STEP 4: RECESSION RISK QUANTIFICATION\n\n    **Task:** Calculate 6-month and 12-month recession probabilities using additive risk model.\n\n    ### 4A. Start with Base Risk\n    - 6-month baseline: 0.05 (5%)\n    - 12-month baseline: 0.10 (10%)\n\n    ### 4B. Add Risk Factors (cumulative, each factor adds risk)\n    **Economic Deterioration (+0.10 to +0.20 each):**\n    - GDP growth negative: +0.20 (6M), +0.15 (12M)\n    - GDP growth <1%: +0.10 (6M), +0.08 (12M)\n    - Unemployment >6.5%: +0.15 (6M), +0.10 (12M)\n    - Industrial production negative YY: +0.12 (6M), +0.10 (12M)\n    - ISM PMI <45 (deep contraction): +0.20 (6M), +0.15 (12M)\n    - ISM PMI 45-50 (mild contraction): +0.10 (6M), +0.08 (12M)\n\n    **Market Stress Indicators (+0.08 to +0.15 each):**\n    - Yield curve inverted: +0.15 (6M), +0.20 (12M) - leading indicator\n    - Credit spreads >700bps (stress): +0.15 (6M), +0.12 (12M)\n    - Credit spreads 500-700bps (widening): +0.08 (6M), +0.08 (12M)\n    - VIX >30: +0.10 (6M), +0.08 (12M)\n\n    **Sentiment & Narrative (+0.05 to +0.10 each):**\n    - News dominated by layoff/contraction themes: +0.08 (6M), +0.08 (12M)\n    - Policy stance defensive/emergency easing: +0.10 (6M), +0.08 (12M)\n\n    ### 4C. Subtract Risk Factors (each factor reduces risk)\n    **Economic Strength (-0.05 to -0.15 each):**\n    - GDP growth >3%: -0.10 (6M), -0.08 (12M)\n    - ISM PMI >55: -0.10 (6M), -0.08 (12M)\n    - Unemployment <4.5%: -0.05 (6M), -0.03 (12M)\n    - Strong earnings growth forecast (>10%): -0.08 (6M), -0.05 (12M)\n\n    **Market Optimism (-0.03 to -0.10 each):**\n    - Credit spreads <300bps: -0.08 (6M), -0.05 (12M)\n    - Yield curve >100bps (steep): -0.05 (6M), -0.03 (12M)\n    - VIX <15: -0.03 (6M), -0.02 (12M)\n\n    ### 4D. Final Calculation\n    - Sum all applicable risk factors\n    - Cap maximum at 0.95 (never assign 100% certainty)\n    - Floor minimum at 0.01 (always maintain non-zero tail risk)\n    - Ensure 12M risk ≥ 6M risk (longer horizon should not have lower risk)\n\n    ### 4E. Identify Recession Drivers\n    List the 2-4 most significant factors contributing to recession risk:\n    - Be specific with data points (e.g., \"ISM PMI at 44 signals manufacturing contraction\")\n    - Prioritize leading indicators over lagging\n    - Include forward-looking concerns if confidence is moderate\n\n    **Output for Step 4:** 6M and 12M recession risk scores with driver list.\n\n    ---\n\n    ## STEP 5: PORTFOLIO POSITIONING STRATEGY\n\n    **Task:** Apply regime-specific sector tilts and generate actionable recommendations.\n\n    ### 5A. Apply Exact Regime Tilts\n\n    **EARLY_CYCLE Positioning:**\n    ```\n    Technology: +0.04\n    Industrials: +0.04\n    Consumer Discretionary: +0.05\n    Financials: +0.03\n    Real Estate: +0.03\n    Materials: +0.03\n    Utilities: -0.04\n    Consumer Staples: -0.03\n    Factor: GROWTH_MOMENTUM\n    ```\n\n    **MID_CYCLE Positioning:**\n    ```\n    Technology: +0.01\n    Communication Services: +0.01\n    (All other sectors: 0.00 or minimal tilts)\n    Factor: BALANCED\n    ```\n\n    **LATE_CYCLE Positioning:**\n    ```\n    Energy: +0.05\n    Healthcare: +0.02\n    Consumer Staples: +0.03\n    Utilities: +0.02\n    Technology: -0.03\n    Consumer Discretionary: -0.03\n    Financials: -0.02\n    Industrials: -0.02\n    Factor: QUALITY_DEFENSIVE\n    ```\n\n    **RECESSION Positioning:**\n    ```\n    Consumer Staples: +0.06\n    Healthcare: +0.05\n    Utilities: +0.04\n    Technology: -0.06\n    Consumer Discretionary: -0.05\n    Financials: -0.05\n    Industrials: -0.04\n    Real Estate: -0.04\n    Factor: QUALITY_DEFENSIVE\n    ```\n\n    **UNCERTAIN Positioning:**\n    - Use MID_CYCLE tilts as neutral baseline\n    - Reduce all tilt magnitudes by 50% (e.g., +0.04 becomes +0.02)\n    - Increase defensive quality bias slightly\n    - Factor: BALANCED\n\n    ### 5B. Generate Overweight Recommendations (3-5 sectors)\n    For each recommended overweight:\n    - Cite the regime logic (e.g., \"Early cycle favors cyclical growth sectors\")\n    - Reference specific data supporting the tilt (e.g., \"Accelerating GDP supports industrials\")\n    - Keep rationale concise (15-25 words)\n\n    Format: \"Sector: Rationale citing regime and data\"\n    Example: \"Technology: Early cycle growth momentum favors innovation leaders; earnings growth forecast of 12% supports\"\n\n    ### 5C. Generate Underweight Recommendations (3-5 sectors)\n    For each recommended underweight:\n    - Cite the regime logic (e.g., \"Late cycle risks elevate vulnerability of cyclicals\")\n    - Reference specific data supporting the tilt (e.g., \"Decelerating GDP pressures discretionary spending\")\n    - Keep rationale concise (15-25 words)\n\n    Format: \"Sector: Rationale citing regime and data\"\n    Example: \"Consumer Discretionary: Late cycle slowdown pressures discretionary spending; unemployment rising toward 5%\"\n\n    ### 5D. Assign Factor Exposure\n    Based on regime classification, assign the appropriate factor strategy:\n    - EARLY_CYCLE → GROWTH_MOMENTUM\n    - MID_CYCLE → BALANCED\n    - LATE_CYCLE → QUALITY_DEFENSIVE\n    - RECESSION → QUALITY_DEFENSIVE\n    - UNCERTAIN → BALANCED\n\n    **Output for Step 5:** Complete sector_tilts map, overweight/underweight arrays, and factor exposure.\n\n    ---\n\n    ## STEP 6: RISK IDENTIFICATION & MONITORING\n\n    **Task:** Identify forward-looking risks and document conflicting signals.\n\n    ### 6A. Primary Risks (2-3 most important)\n    Focus on:\n    - Leading indicators that could signal regime transition\n    - Macro vulnerabilities specific to {{ country }}\n    - Policy risks (central bank, fiscal, geopolitical)\n    - Market structure risks (liquidity, volatility regime change)\n\n    Format: Clear, specific risk statements (10-20 words each)\n    Example: \"Yield curve inversion deepening suggests recession risk within 12-18 months\"\n    Example: \"Central bank may overtighten if inflation remains elevated above 4%\"\n\n    ### 6B. Conflicting Signals\n    Document any significant contradictions:\n    - Leading vs lagging indicator divergence\n    - Economic data vs market pricing discrepancies\n    - Country-specific vs global indicator conflicts\n    - Return empty array if no major contradictions exist\n\n    Format: \"Indicator A shows X, but Indicator B shows Y\"\n    Example: \"GDP growth remains positive at 2.1%, but ISM PMI at 48 signals manufacturing contraction\"\n\n    **Output for Step 6:** Primary risks array and conflicting signals array.\n\n    ---\n\n    # OUTPUT REQUIREMENTS\n\n    Provide your complete analysis following the structure defined in:\n    {{ ctx.output_format }}\n\n    # EXECUTION INSTRUCTION\n\n    Now analyze the provided data for {{ country }} using the systematic 6-step framework. Document your reasoning explicitly for each step, then provide the final structured classification according to {{ ctx.output_format }}.\n\n    Begin your analysis.\n  \"#\n}\n",
    "generators.baml": "// This helps use auto generate libraries you can use in the language of\n// your choice. You can have multiple generators if you use multiple languages.\n// Just ensure that the output_dir is different for each generator.\ngenerator target {\n    // Valid values: \"python/pydantic\", \"typescript\", \"ruby/sorbet\", \"rest/openapi\"\n    output_type \"python/pydantic\"\n\n    // Where the generated code will be saved (relative to baml_src/)\n    output_dir \"../\"\n\n    // The version of the BAML package you have installed (e.g. same version as your baml-py or @boundaryml/baml).\n    // The BAML VSCode extension version should also match this version.\n    version \"0.217.0\"\n\n    // Valid values: \"sync\", \"async\"\n    // This controls what `b.FunctionName()` will be (sync or async).\n    default_client_mode sync\n}\n",
    "stock_news_summary.baml": "// Stock News Summarization for Black-Litterman View Generation\r\n// Similar to macro news summarization but focused on company-specific signals\r\n\r\n// NewsArticle class is already defined in summarize_news.baml\r\n// We'll import and reuse it\r\n\r\nenum CompanyMomentum {\r\n  ACCELERATING\r\n  POSITIVE\r\n  STABLE\r\n  SLOWING\r\n  NEGATIVE\r\n}\r\n\r\nenum EarningsOutlook {\r\n  BEATS_EXPECTED\r\n  MEETS_EXPECTED\r\n  BELOW_EXPECTED\r\n  UNCERTAIN\r\n}\r\n\r\nenum ManagementSentiment {\r\n  VERY_BULLISH\r\n  BULLISH\r\n  NEUTRAL\r\n  CAUTIOUS\r\n  PESSIMISTIC\r\n}\r\n\r\nenum CompetitivePosition {\r\n  STRENGTHENING\r\n  STABLE\r\n  WEAKENING\r\n  UNDER_PRESSURE\r\n}\r\n\r\nclass StockNewsSignals {\r\n  // Overall narrative\r\n  dominant_themes string[]\r\n  @description(#\"\r\n    Top 3-5 themes from company news (e.g., \"Strong earnings beat\", \"Product launch success\", \"Regulatory concerns\")\r\n  \"#)\r\n\r\n  // Business momentum\r\n  company_momentum CompanyMomentum\r\n  momentum_summary string\r\n  @description(#\"\r\n    2-3 sentences on business growth, revenue trends, market share changes\r\n  \"#)\r\n\r\n  // Earnings and financials\r\n  earnings_outlook EarningsOutlook\r\n  earnings_summary string\r\n  @description(#\"\r\n    2-3 sentences on recent/expected earnings, guidance, profitability\r\n  \"#)\r\n\r\n  // Management and strategy\r\n  management_sentiment ManagementSentiment\r\n  management_summary string\r\n  @description(#\"\r\n    2-3 sentences on management commentary, strategic initiatives, capital allocation\r\n  \"#)\r\n\r\n  // Competitive dynamics\r\n  competitive_position CompetitivePosition\r\n  competitive_summary string\r\n  @description(#\"\r\n    2-3 sentences on competitive positioning, industry trends, market dynamics\r\n  \"#)\r\n\r\n  // Specific catalysts or risks\r\n  key_catalysts string[]\r\n  @description(#\"\r\n    List of specific positive catalysts mentioned (e.g., \"New product launch\", \"Partnership announced\")\r\n  \"#)\r\n\r\n  key_risks string[]\r\n  @description(#\"\r\n    List of specific risks or concerns (e.g., \"Regulatory investigation\", \"Supply chain issues\")\r\n  \"#)\r\n\r\n  // Overall assessment\r\n  news_bias string\r\n  @description(#\"\r\n    Overall tone: \"BULLISH\", \"NEUTRAL\", or \"BEARISH\"\r\n  \"#)\r\n\r\n  confidence_assessment string\r\n  @description(#\"\r\n    How clear/actionable the news signal is: \"HIGH\", \"MEDIUM\", \"LOW\"\r\n  \"#)\r\n}\r\n\r\nfunction SummarizeStockNews(\r\n  ticker: string,\r\n  news: NewsArticle[]\r\n) -> StockNewsSignals {\r\n  client AzureOpenAIGpt5\r\n\r\n  prompt #\"\r\n    {{ _.role(\"system\") }}\r\n    You are a senior equity analyst specializing in extracting actionable investment signals from company news for Black-Litterman portfolio optimization. Your outputs feed directly into a quantitative model that determines expected returns and position sizing.\r\n\r\n    Core competencies:\r\n    - Synthesize multiple news sources into coherent company narratives\r\n    - Extract forward-looking signals that predict stock performance\r\n    - Classify sentiment consistently using predefined categories\r\n    - Balance positive and negative signals objectively\r\n\r\n    {{ _.role(\"user\") }}\r\n    # OBJECTIVE\r\n    Analyze {{ news | length }} news articles for {{ ticker }} and extract structured investment signals for Black-Litterman view generation.\r\n\r\n    # INPUT DATA: NEWS ARTICLES ({{ ticker }})\r\n\r\n    {% for article in news %}\r\n    ## Article {{ loop.index }} | {{ article.date }}\r\n    **Title:** {{ article.title }}\r\n    **Source:** {{ article.publisher }}\r\n    {% if article.full_content %}\r\n    **Full Content:**\r\n    {{ article.full_content }}\r\n    {% elif article.summary %}\r\n    **Summary:**\r\n    {{ article.summary }}\r\n    {% endif %}\r\n\r\n    {% endfor %}\r\n\r\n    # ANALYSIS FRAMEWORK\r\n\r\n    ## Step 1: Identify Cross-Article Patterns\r\n    Scan all {{ news | length }} articles to identify:\r\n    - Recurring themes mentioned in 2+ articles\r\n    - Consensus vs. divergent viewpoints\r\n    - Forward-looking statements (guidance, forecasts, launches) vs. historical results\r\n    - Specific numbers (revenue, earnings, growth rates, margins)\r\n    - Management commentary and tone shifts\r\n\r\n    ## Step 2: Extract Structured Signals\r\n\r\n    ### 2.1 Dominant Themes (3-5 themes)\r\n    Extract the most frequently discussed company-specific topics.\r\n    - Format: Concise phrases (4-6 words each)\r\n    - Examples: \"Earnings beat analyst estimates\", \"New product launch announced\", \"Regulatory approval delayed\", \"Market share gains evident\"\r\n    - Prioritize themes that appear in multiple articles or from credible sources\r\n\r\n    ### 2.2 Company Momentum\r\n    **Classification:**\r\n    - ACCELERATING: Revenue/earnings accelerating, market share gains, strong growth trajectory\r\n    - POSITIVE: Solid growth, positive trends, expanding margins, good execution\r\n    - STABLE: Steady performance, in-line results, maintaining position\r\n    - SLOWING: Decelerating growth, margin pressure, weakening metrics\r\n    - NEGATIVE: Declining revenue/earnings, losing share, deteriorating fundamentals\r\n\r\n    **Summary Requirements:**\r\n    - 2-3 sentences maximum\r\n    - Include specific metrics (revenue growth %, EPS, guidance)\r\n    - Focus on: Business trends, growth rates, operational performance\r\n\r\n    ### 2.3 Earnings Outlook\r\n    **Classification:**\r\n    - BEATS_EXPECTED: Recent beat, raised guidance, positive surprises\r\n    - MEETS_EXPECTED: In-line results, confirmed guidance, expectations met\r\n    - BELOW_EXPECTED: Miss, lowered guidance, disappointments\r\n    - UNCERTAIN: Mixed signals, wide analyst range, unclear visibility\r\n\r\n    **Summary Requirements:**\r\n    - 2-3 sentences maximum\r\n    - Include specific numbers (EPS, revenue, guidance ranges)\r\n    - Note analyst revisions and consensus changes\r\n\r\n    ### 2.4 Management Sentiment\r\n    **Classification:**\r\n    - VERY_BULLISH: Highly confident, raising targets, aggressive expansion\r\n    - BULLISH: Optimistic, confident in strategy, positive outlook\r\n    - NEUTRAL: Balanced, cautious optimism, data-dependent\r\n    - CAUTIOUS: Acknowledging headwinds, tempering expectations\r\n    - PESSIMISTIC: Defensive, cutting guidance, significant concerns\r\n\r\n    **Summary Requirements:**\r\n    - 2-3 sentences maximum\r\n    - Quote specific management commentary when impactful\r\n    - Focus on: Strategy updates, capital allocation, outlook statements\r\n\r\n    ### 2.5 Competitive Position\r\n    **Classification:**\r\n    - STRENGTHENING: Gaining share, product/tech advantages, widening moat\r\n    - STABLE: Maintaining position, competitive dynamics unchanged\r\n    - WEAKENING: Losing share, facing new competition, eroding advantages\r\n    - UNDER_PRESSURE: Significant competitive threats, market share losses\r\n\r\n    **Summary Requirements:**\r\n    - 2-3 sentences maximum\r\n    - Include market share data if available\r\n    - Note competitive actions (new products, pricing, M&A)\r\n\r\n    ### 2.6 Catalysts and Risks\r\n    **Key Catalysts** (2-5 items):\r\n    - Specific positive events or developments\r\n    - Examples: \"FDA approval\", \"Major contract win\", \"Strategic partnership\", \"Product launch\"\r\n    - Quantify impact where possible\r\n\r\n    **Key Risks** (2-5 items):\r\n    - Specific concerns or headwinds\r\n    - Examples: \"Regulatory investigation\", \"Supply chain disruption\", \"Customer concentration\", \"Debt refinancing\"\r\n    - Assess materiality\r\n\r\n    ### 2.7 Overall Assessment\r\n    **News Bias:**\r\n    - BULLISH: Predominantly positive news, multiple catalysts, positive surprises\r\n    - NEUTRAL: Balanced news flow, mixed signals, no clear direction\r\n    - BEARISH: Predominantly negative news, risks elevated, negative surprises\r\n\r\n    **Confidence Assessment:**\r\n    - HIGH: Clear signal, consistent across articles, actionable information\r\n    - MEDIUM: Moderately clear, some ambiguity, reasonable conviction\r\n    - LOW: Unclear signal, highly mixed messages, limited actionability\r\n\r\n    ## Step 3: Quality Control\r\n    - [ ] All summaries are 2-3 sentences\r\n    - [ ] Specific numbers included where available\r\n    - [ ] Forward-looking information prioritized\r\n    - [ ] Balanced view (not cherry-picked)\r\n    - [ ] Credible sources weighted appropriately\r\n    - [ ] Catalysts and risks are specific and material\r\n\r\n    # CRITICAL CONSTRAINTS\r\n\r\n    1. **Synthesis**: Extract aggregate signal, don't list individual articles\r\n    2. **Conciseness**: Exactly 2-3 sentences per summary field\r\n    3. **Consistency**: Use exact enum values, don't invent categories\r\n    4. **Data-Driven**: Include numbers when available\r\n    5. **Objectivity**: Reflect true balance of news sentiment\r\n    6. **Actionability**: Focus on signals that impact stock returns\r\n\r\n    # OUTPUT FORMAT\r\n\r\n    {{ ctx.output_format }}\r\n\r\n    ---\r\n\r\n    Now analyze all {{ news | length }} articles for {{ ticker }} following the framework above. Think step-by-step before generating structured output.\r\n  \"#\r\n}\r\n",
    "stock_signals.baml": "// ============================================================================\n// STOCK SIGNAL GENERATION - LLM-BASED TRADING SIGNAL ANALYSIS\n// ============================================================================\n// Institutional-grade stock signal generation using comprehensive yfinance data.\n// Analyzes valuation, momentum, quality, growth, and technical factors to\n// classify stocks into trading signal categories.\n//\n// Signal Types:\n// - large_decline: Significant downward expectation (> 3% potential decline)\n// - small_decline: Minor downward expectation (0-3% potential decline)\n// - neutral: No significant movement expected (�0.5%)\n// - small_gain: Minor upward expectation (0-3% potential gain)\n// - large_gain: Significant upward expectation (> 3% potential gain)\n// ============================================================================\n\n// ============================================================================\n// MACRO REGIME DATA\n// ============================================================================\n\nclass MacroRegimeData {\n  // Country and timestamp\n  country string @description(\"Country code (USA, Germany, etc.)\")\n  assessment_date string @description(\"Date of macro assessment (YYYY-MM-DD)\")\n\n  // Business cycle regime\n  regime string @description(\"Current regime: EARLY_CYCLE, MID_CYCLE, LATE_CYCLE, RECESSION, UNCERTAIN\")\n  confidence float @description(\"Regime classification confidence (0.0-1.0)\")\n  rationale string @description(\"Brief rationale for regime classification\")\n\n  // Key market indicators\n  ism_pmi float? @description(\"ISM Manufacturing PMI (if available)\")\n  ism_signal string? @description(\"ISM signal: STRONG_EXPANSION, MILD_EXPANSION, MILD_CONTRACTION, DEEP_CONTRACTION\")\n\n  yield_curve_2s10s float? @description(\"2s10s yield spread in bps (if available)\")\n  yield_curve_signal string? @description(\"Yield curve signal: STEEP, NORMAL, FLAT, INVERTED\")\n\n  hy_spread float? @description(\"High-yield credit spread in bps (if available)\")\n  credit_spread_signal string? @description(\"Credit spread signal: TIGHT, NEUTRAL, WIDENING, STRESS\")\n\n  vix float? @description(\"VIX volatility index (if available)\")\n\n  // Recession risk\n  recession_risk_6m float @description(\"6-month recession probability (0.0-1.0)\")\n  recession_risk_12m float @description(\"12-month recession probability (0.0-1.0)\")\n\n  // Economic indicators\n  gdp_growth_yy float? @description(\"GDP growth year-over-year %\")\n  unemployment float? @description(\"Unemployment rate %\")\n  inflation float? @description(\"Inflation rate %\")\n\n  // Portfolio positioning context\n  recommended_overweights string[] @description(\"Sectors currently recommended for overweight\")\n  recommended_underweights string[] @description(\"Sectors currently recommended for underweight\")\n  factor_exposure string? @description(\"Recommended factor exposure: GROWTH_MOMENTUM, QUALITY_DEFENSIVE, BALANCED\")\n\n  // Risk monitoring\n  primary_risks string[] @description(\"2-3 main macro risks to monitor\")\n}\n\n// ============================================================================\n// ENUMS AND OUTPUT TYPES\n// ============================================================================\n\nenum SignalType {\n  // Bearish Signals\n  LARGE_DECLINE @alias(\"large_decline\") @description(#\"\n    Significant downward movement expected (> 3%).\n    Indicators: Overvaluation, negative momentum, deteriorating fundamentals,\n    bearish technicals, negative analyst sentiment.\n  \"#)\n\n  SMALL_DECLINE @alias(\"small_decline\") @description(#\"\n    Minor downward movement expected (0-3%).\n    Indicators: Slight overvaluation, weakening momentum, mixed fundamentals,\n    neutral to slightly bearish technicals.\n  \"#)\n\n  // Neutral\n  NEUTRAL @alias(\"neutral\") @description(#\"\n    No significant movement expected (�0.5%).\n    Indicators: Fair valuation, sideways momentum, stable fundamentals,\n    neutral technicals, mixed analyst sentiment.\n  \"#)\n\n  // Bullish Signals\n  SMALL_GAIN @alias(\"small_gain\") @description(#\"\n    Minor upward movement expected (0-3%).\n    Indicators: Slight undervaluation, positive momentum, improving fundamentals,\n    neutral to slightly bullish technicals.\n  \"#)\n\n  LARGE_GAIN @alias(\"large_gain\") @description(#\"\n    Significant upward movement expected (> 3%).\n    Indicators: Strong undervaluation, strong positive momentum, excellent fundamentals,\n    bullish technicals, positive analyst consensus.\n  \"#)\n}\n\n// Confidence level for signal classification\nenum ConfidenceLevel {\n  LOW @alias(\"low\") @description(\"< 60% confidence due to mixed signals or limited data\")\n  MEDIUM @alias(\"medium\") @description(\"60-80% confidence with moderate signal alignment\")\n  HIGH @alias(\"high\") @description(\"> 80% confidence with strong signal alignment across factors\")\n}\n\n// Key factors driving the signal\nclass SignalDrivers {\n  // Valuation Assessment (-1 to +1: -1 = very overvalued, +1 = very undervalued)\n  valuation_score float @description(\"Composite valuation score based on P/E, P/B, price vs targets\")\n  valuation_summary string @description(\"Brief valuation assessment (1-2 sentences)\")\n\n  // Momentum Assessment (-1 to +1: -1 = strong downtrend, +1 = strong uptrend)\n  momentum_score float @description(\"Price momentum based on 52-week performance, moving averages\")\n  momentum_summary string @description(\"Brief momentum assessment (1-2 sentences)\")\n\n  // Quality Assessment (0 to 1: quality of business fundamentals)\n  quality_score float @description(\"Business quality based on margins, ROE, debt levels\")\n  quality_summary string @description(\"Brief quality assessment (1-2 sentences)\")\n\n  // Growth Assessment (-1 to +1: -1 = contracting, +1 = high growth)\n  growth_score float @description(\"Growth prospects based on revenue/earnings growth\")\n  growth_summary string @description(\"Brief growth assessment (1-2 sentences)\")\n\n  // Technical Assessment (-1 to +1: -1 = very bearish, +1 = very bullish)\n  technical_score float? @description(\"Technical indicators: RSI, moving averages, volume trends\")\n  technical_summary string? @description(\"Brief technical assessment if data available\")\n\n  // Analyst Sentiment (-1 to +1: -1 = strong sell consensus, +1 = strong buy consensus)\n  analyst_score float? @description(\"Analyst consensus and ratings\")\n  analyst_summary string? @description(\"Brief analyst sentiment summary\")\n}\n\n// Risk factors and considerations\nclass RiskFactors {\n  // Market risk factors\n  volatility_level string @description(\"Low/Medium/High - historical volatility assessment\")\n  beta_risk string? @description(\"Market sensitivity assessment if beta available\")\n\n  // Company-specific risks\n  debt_risk string @description(\"Assessment of debt levels and financial leverage\")\n  liquidity_risk string @description(\"Assessment of trading liquidity and market depth\")\n\n  // Data quality concerns\n  data_gaps string[] @description(\"List of missing or unreliable data points that affected analysis\")\n\n  // Key risks summary\n  primary_risks string[] @description(\"Top 3-5 key risks to the signal thesis\")\n}\n\n// Main output structure matching database schema\nclass StockSignalOutput {\n  // Signal Classification (required)\n  signal_type SignalType @description(\"Primary trading signal classification\")\n\n  // Date and Price Data\n  signal_date string @description(\"Date for the signal (YYYY-MM-DD format)\")\n  close_price float? @description(\"Current/most recent closing price\")\n  open_price float? @description(\"Most recent opening price\")\n\n  // Daily metrics\n  daily_return float? @description(\"Most recent daily return percentage\")\n  volume float? @description(\"Recent trading volume\")\n\n  // Technical indicators\n  volatility float? @description(\"Historical volatility (annualized standard deviation)\")\n  rsi float? @description(\"Relative Strength Index if available from yfinance\")\n\n  // Analysis metadata\n  data_quality_score float @description(#\"\n    Data quality score 0-1 based on completeness of input data.\n    1.0 = all key fields present, 0.5 = moderate data, 0.0 = minimal data\n  \"#)\n\n  confidence_level ConfidenceLevel @description(\"Confidence in signal classification\")\n\n  // Detailed analysis (required)\n  analysis_notes string @description(#\"\n    Concise analysis explaining the signal classification.\n    Maximum 2-3 sentences covering:\n    1. Primary signal driver and rationale\n    2. Key supporting factors or risks\n    3. Overall conviction level\n    Professional, institutional tone. Be concise and actionable.\n  \"#)\n\n  // Structured signal drivers\n  signal_drivers SignalDrivers @description(\"Quantified assessment across key factors\")\n\n  // Risk assessment\n  risk_factors RiskFactors @description(\"Identified risks and data quality concerns\")\n\n  // Price targets (if derivable from data)\n  upside_potential_pct float? @description(\"Estimated upside % to fair value or target\")\n  downside_risk_pct float? @description(\"Estimated downside % risk to support levels\")\n}\n\n// ============================================================================\n// MAIN SIGNAL GENERATION FUNCTION\n// ============================================================================\n\nfunction GenerateStockSignal(\n  stock_data: ComprehensiveYFinanceData,\n  target_date: string,\n  macro_regime: MacroRegimeData?,\n  recent_news: NewsArticle[]?,\n  calculated_open_price: float?,\n  calculated_volatility: float?,\n  calculated_rsi: float?\n) -> StockSignalOutput {\n  client AzureOpenAIGpt5\n\n  prompt #\"\n    You are an institutional quantitative analyst generating a trading signal for {{ stock_data.ticker }} ({{ stock_data.company_name }}) as of {{ target_date }}.\n\n    === STOCK DATA ===\n    Ticker: {{ stock_data.ticker }} | Data Completeness: {{ stock_data.data_completeness_pct }}% | Fields: {{ stock_data.yfinance_info_dict_size }}\n\n    === CALCULATED METRICS (use these exact values) ===\n    {% if calculated_open_price %}Open: ${{ calculated_open_price }} | {% endif %}{% if calculated_volatility %}Vol: {{ (calculated_volatility * 100) | round(2) }}% | {% endif %}{% if calculated_rsi %}RSI: {{ calculated_rsi | round(2) }}{% endif %}\n\n    {% if macro_regime %}\n    === MACRO CONTEXT: {{ macro_regime.country }} ({{ macro_regime.regime }}, {{ (macro_regime.confidence * 100) | round(0) }}% confidence) ===\n    Recession Risk: 6m={{ (macro_regime.recession_risk_6m * 100) | round(0) }}%, 12m={{ (macro_regime.recession_risk_12m * 100) | round(0) }}%\n    {% if macro_regime.ism_pmi %}ISM={{ macro_regime.ism_pmi }} ({{ macro_regime.ism_signal }}) | {% endif %}{% if macro_regime.yield_curve_2s10s %}Curve={{ macro_regime.yield_curve_2s10s }}bps ({{ macro_regime.yield_curve_signal }}) | {% endif %}{% if macro_regime.hy_spread %}HY={{ macro_regime.hy_spread }}bps{% endif %}\n    Overweight: {{ macro_regime.recommended_overweights | join(', ') }} | Underweight: {{ macro_regime.recommended_underweights | join(', ') }}\n\n    REGIME RULES:\n    {% if macro_regime.regime == 'RECESSION' or macro_regime.recession_risk_12m > 0.4 %}\n    RECESSION: Quality=35%, Val=25%, Mom=15%, Growth=10%. Require ROE>15%, D/E<1.0, +FCF. Downgrade unless defensive.\n    {% elif macro_regime.regime == 'LATE_CYCLE' %}\n    LATE_CYCLE: Quality=30%, Val=25%, Growth=15%, Mom=15%. Favor defensives, strong balance sheets.\n    {% elif macro_regime.regime == 'EARLY_CYCLE' %}\n    EARLY_CYCLE: Mom=30%, Growth=25%, Val=15%, Quality=15%. Favor cyclicals, growth stocks.\n    {% else %}\n    MID_CYCLE: Val=25%, Mom=20%, Quality=20%, Growth=20%. Balanced approach.\n    {% endif %}\n    Sector alignment: Overweight +0.2, Underweight -0.2 to composite score.\n    {% endif %}\n\n    {% if recent_news and recent_news | length > 0 %}\n    === NEWS ({{ recent_news | length }} articles) ===\n    {% for article in recent_news %}\n    [{{ loop.index }}] {{ article.title }} ({{ article.publisher }}, {{ article.date }})\n    {% if article.summary %}Summary: {{ article.summary }}{% endif %}\n    {% endfor %}\n\n    NEWS RULES: Bullish=earnings beats, innovations, partnerships, upgrades. Bearish=misses, lawsuits, layoffs, downgrades. Weight recent articles higher. Integrate sentiment into momentum/analyst scores.\n    {% endif %}\n\n    {% if stock_data.company_info %}\n    === COMPANY ===\n    {{ stock_data.company_info.sector }} / {{ stock_data.company_info.industry }} / {{ stock_data.company_info.country }} | Employees: {{ stock_data.company_info.fullTimeEmployees }}\n    {{ stock_data.company_info.longBusinessSummary }}\n    {% endif %}\n\n    {% if stock_data.price_data %}\n    === PRICE & VALUATION ===\n    Price: ${{ stock_data.price_data.currentPrice }} | 52W: ${{ stock_data.price_data.fiftyTwoWeekLow }}-${{ stock_data.price_data.fiftyTwoWeekHigh }} (Chg: {{ stock_data.price_data.fiftyTwoWeekChangePercent }}%, From High: {{ stock_data.price_data.fiftyTwoWeekHighChangePercent }}%)\n    {% if stock_data.price_data.targetMeanPrice %}Target: ${{ stock_data.price_data.targetMeanPrice }} (Upside: {{ ((stock_data.price_data.targetMeanPrice - stock_data.price_data.currentPrice) / stock_data.price_data.currentPrice * 100) }}%) | {% endif %}P/B: {{ stock_data.price_data.priceToBook }} | P/S: {{ stock_data.price_data.priceToSalesTrailing12Months }}\n    {% endif %}\n\n    {% if stock_data.technical_data %}\n    === TECHNICALS ===\n    P/E: {{ stock_data.technical_data.trailingPE }} (Fwd: {{ stock_data.technical_data.forwardPE }}) | EPS: ${{ stock_data.technical_data.epsTrailingTwelveMonths }} (Fwd: ${{ stock_data.technical_data.forwardEps }}) | Beta: {{ stock_data.technical_data.beta }}\n    MAs: 50D=${{ stock_data.technical_data.fiftyDayAverage }} ({{ stock_data.technical_data.fiftyDayAverageChangePercent }}%), 200D=${{ stock_data.technical_data.twoHundredDayAverage }} ({{ stock_data.technical_data.twoHundredDayAverageChangePercent }}%)\n    {% endif %}\n\n    {% if stock_data.financial_metrics %}\n    === FINANCIALS ===\n    Margins: Profit={{ stock_data.financial_metrics.profitMargins }}, Gross={{ stock_data.financial_metrics.grossMargins }}, Op={{ stock_data.financial_metrics.operatingMargins }}\n    Returns: ROE={{ stock_data.financial_metrics.returnOnEquity }}, ROA={{ stock_data.financial_metrics.returnOnAssets }}\n    Growth: Rev={{ stock_data.financial_metrics.revenueGrowth }}, Earn={{ stock_data.financial_metrics.earningsGrowth }}, QtrEarn={{ stock_data.financial_metrics.earningsQuarterlyGrowth }}\n    Balance: D/E={{ stock_data.financial_metrics.debtToEquity }}, Current={{ stock_data.financial_metrics.currentRatio }}, Quick={{ stock_data.financial_metrics.quickRatio }}\n    Cash Flow: OCF=${{ stock_data.financial_metrics.operatingCashflow }}, FCF=${{ stock_data.financial_metrics.freeCashflow }} | Cash=${{ stock_data.financial_metrics.totalCash }}, Debt=${{ stock_data.financial_metrics.totalDebt }}\n    {% endif %}\n\n    {% if stock_data.market_data %}\n    === MARKET DATA ===\n    MCap: ${{ stock_data.market_data.marketCap }} | Vol: {{ stock_data.market_data.volume }} (10d: {{ stock_data.market_data.averageVolume10days }}, 3m: {{ stock_data.market_data.averageDailyVolume3Month }})\n    {% if stock_data.market_data.sharesShort %}Short: {{ stock_data.market_data.shortPercentOfFloat }}% float | {% endif %}Inst: {{ stock_data.market_data.heldPercentInstitutions }}, Insider: {{ stock_data.market_data.heldPercentInsiders }}\n    {% endif %}\n\n    {% if stock_data.analyst_data %}\n    === ANALYSTS ===\n    {{ stock_data.analyst_data.recommendationKey }} (Score: {{ stock_data.analyst_data.recommendationMean }}/5, {{ stock_data.analyst_data.numberOfAnalystOpinions }} analysts)\n    {% endif %}\n\n    {% if stock_data.dividend_data %}\n    === DIVIDEND ===\n    Yield: {{ stock_data.dividend_data.dividendYield }} | Rate: ${{ stock_data.dividend_data.dividendRate }} | 5Y Avg: {{ stock_data.dividend_data.fiveYearAvgDividendYield }}\n    {% endif %}\n\n    {% if stock_data.governance %}\n    === GOVERNANCE ===\n    Risk: Overall={{ stock_data.governance.overallRisk }}, Board={{ stock_data.governance.boardRisk }}, Comp={{ stock_data.governance.compensationRisk }}\n    {% endif %}\n\n    === FACTOR ANALYSIS (Fama-French + Carhart) ===\n\n    1. VALUATION (-1 to +1): P/E (<15 value, 15-25 fair, >30 growth/overvalued), P/B, FCF yield (>5% attractive), price vs targets. Score: -1 (very overvalued) to +1 (deep value).\n\n    2. MOMENTUM (-1 to +1): 52W performance, MA position (above 50D+200D = strong uptrend +0.5/+1.0, below both = downtrend -0.5/-1.0), relative strength vs sector. Score: -1 (strong downtrend) to +1 (strong uptrend).\n\n    3. QUALITY (0 to 1): ROE (>15% high, <10% low), ROA (>8% strong, <3% weak), margins (Op>15% excellent, <5% weak), D/E (<0.5 conservative, >2.0 leveraged), current ratio (>1.5 good, <1.0 weak), FCF (positive/growing). Score: 0 (poor quality) to 1 (fortress balance sheet).\n\n    4. GROWTH (-1 to +1): Rev growth (>20% high, 5-10% moderate, <0% contraction), Earn growth (>15% strong), sustainable/profitable growth. Avoid excessive M&A. Score: -1 (contracting) to +1 (sustainable high growth).\n\n    5. TECHNICAL (-1 to +1, if available): RSI (<30 oversold, >70 overbought), MA trends, volume patterns, beta (>1.5 high-beta, <0.7 defensive). Score: -1 (bearish) to +1 (bullish).\n\n    6. ANALYST (-1 to +1, if available): Rec mean (1-1.5 Strong Buy, 2.5-3.5 Hold, 4.5-5 Sell), coverage breadth, price target upside. Score: -1 (sell consensus) to +1 (buy consensus).\n\n    SIZE (informational): Mega >$200B, Large $10-200B, Mid $2-10B, Small $300M-2B, Micro <$300M. Note in risk_factors.\n\n    === SIGNAL CLASSIFICATION ===\n\n    COMPOSITE: Weight factors by regime (already specified above), add sector alignment (±0.2).\n\n    RISK ADJUSTMENTS:\n    - D/E>2.5 (RECESSION/LATE) or >4.0 (any): Downgrade 1 category\n    - Vol<$1M: LOW confidence | Vol<$5M: note liquidity risk\n    - Neg FCF+low growth: max neutral | P/E>50 w/o growth: cap small_gain | P/E>100: cap neutral\n    - Data<50%: LOW confidence, cap small_gain/decline\n\n    THRESHOLDS:\n    LARGE_GAIN: >+0.4 + 3+ aligned factors | SMALL_GAIN: +0.15 to +0.4 | NEUTRAL: -0.15 to +0.15 | SMALL_DECLINE: -0.4 to -0.15 | LARGE_DECLINE: <-0.4 + 3+ aligned\n\n    OVERRIDES: RECESSION+D/E>2.0+neg FCF=max small_decline | LATE_CYCLE+P/E>30+weak mom=neutral | Distressed (int cov<1.5)=max small_decline\n\n    === OUTPUT REQUIREMENTS ===\n\n    1. signal_type: Use thresholds above with risk adjustments\n    2. confidence_level: HIGH (>80%, data>70%, 4+ aligned) | MEDIUM (60-80%, data 50-70%, 2-3 aligned) | LOW (<60%, data<50% OR conflicting)\n    3. analysis_notes: 2-3 sentences. S1: Primary thesis+driver. S2: Supporting factors/risks. S3: Conviction+positioning. Institutional tone.\n    4. signal_drivers: Score each factor per framework above. 1-2 sentence summary with specific metrics.\n       - Valuation (-1 to +1): P/E, P/B, FCF yield, vs targets\n       - Momentum (-1 to +1): 52W perf, MA position, relative strength\n       - Quality (0 to 1): ROE, ROA, margins, D/E, FCF\n       - Growth (-1 to +1): Rev/Earn growth, sustainability\n       - Technical (-1 to +1, opt): RSI, MAs, beta\n       - Analyst (-1 to +1, opt): Rec consensus, target upside\n    5. risk_factors:\n       - volatility_level: Low (<20%), Medium (20-40%), High (>40%)\n       - beta_risk (opt): Market sensitivity if beta available\n       - debt_risk: D/E, interest coverage, flag if concerning\n       - liquidity_risk: ADV, market cap, flag if <$5M ADV or micro-cap\n       - data_gaps[]: List missing data\n       - primary_risks[]: Top 3-5 risks (macro, company, valuation, liquidity)\n    6. data_quality_score: 0.9-1.0 (comprehensive) | 0.7-0.9 (good) | 0.5-0.7 (moderate) | 0.3-0.5 (limited) | 0-0.3 (minimal)\n    7. Price targets (opt): upside_potential_pct (analyst target or fair value), downside_risk_pct (support levels, bear case). Express as %.\n    8. Price/volume: signal_date={{ target_date }}, close_price (currentPrice), open_price={{ calculated_open_price if calculated_open_price else \"null\" }}, volume, volatility={{ calculated_volatility if calculated_volatility else \"null\" }}, rsi={{ calculated_rsi if calculated_rsi else \"null\" }}\n\n    CHECKS: ✓ Coherent scores ✓ Conservative confidence ✓ Concise notes ✓ Specific risks ✓ Honest data_gaps ✓ Data-driven targets\n\n    {{ ctx.output_format }}\n  \"#\n}",
    "summarize_news.baml": "class NewsArticle {\n  title string\n  publisher string\n  date string\n  link string?\n  summary string?  // Article summary from yfinance API (short snippet)\n  full_content string?  // Full article content fetched from URL (preferred for analysis)\n}\n\nenum GrowthSentiment {\n  ACCELERATING\n  STABLE\n  SLOWING\n  CONTRACTING\n}\n\nenum InflationSentiment {\n  RISING\n  STABLE\n  FALLING\n  ELEVATED\n}\n\nenum LaborMarketSentiment {\n  STRONG\n  HEALTHY\n  SOFTENING\n  WEAK\n}\n\nenum PolicyStance {\n  DOVISH\n  NEUTRAL\n  HAWKISH\n  TIGHTENING\n  EASING\n}\n\nenum RiskAppetite {\n  RISK_ON\n  NEUTRAL\n  CAUTIOUS\n  RISK_OFF\n  FEAR\n}\n\nenum RegimeNarrative {\n  EARLY_CYCLE\n  MID_CYCLE\n  LATE_CYCLE\n  RECESSION\n  UNCERTAIN\n}\n\nclass MacroNewsSignals {\n  // Dominant themes across all articles\n  dominant_themes string[]\n  @description(#\"\n    Top 3-5 themes (e.g., \"Fed hawkish tone\", \"recession fears rising\")\n  \"#)\n\n  // Growth outlook\n  growth_sentiment GrowthSentiment\n  growth_summary string\n  @description(#\"\n    2-3 sentences on GDP, earnings, business activity trends\n  \"#)\n\n  // Inflation outlook\n  inflation_sentiment InflationSentiment\n  inflation_summary string\n  @description(#\"\n    2-3 sentences on inflation trends and central bank response\n  \"#)\n\n  // Labor market\n  labor_market_sentiment LaborMarketSentiment\n  labor_market_summary string\n  @description(#\"\n    2-3 sentences on unemployment, hiring, layoffs\n  \"#)\n\n  // Central bank policy\n  policy_stance PolicyStance\n  policy_summary string\n  @description(#\"\n    2-3 sentences on monetary policy tone and expectations\n  \"#)\n\n  // Market conditions\n  risk_appetite RiskAppetite\n\n  // Regime indicators\n  regime_narrative RegimeNarrative\n  regime_rationale string\n  @description(#\"\n    2-3 sentences explaining why news suggests this regime\n  \"#)\n}\n\nfunction SummarizeNewsArticles(\n  news: NewsArticle[],\n  country: string\n) -> MacroNewsSignals {\n  client AzureOpenAIGpt5\n\n  prompt #\"\n    {{ _.role(\"system\") }}\n    You are a senior macroeconomic analyst specializing in extracting actionable signals from financial news for business cycle analysis. Your outputs feed directly into a business cycle classification model that determines portfolio positioning.\n\n    Core competencies:\n    - Synthesize multiple news sources into coherent macroeconomic narratives\n    - Classify sentiment consistently using predefined categories\n    - Extract forward-looking signals that predict cycle transitions\n    - Maintain objectivity by balancing bullish and bearish signals\n\n    {{ _.role(\"user\") }}\n    # OBJECTIVE\n    Analyze {{ news | length }} news articles for {{ country }} and extract structured macroeconomic signals that will be used by a downstream business cycle classifier.\n\n    # INPUT DATA: NEWS ARTICLES ({{ country }})\n\n    {% for article in news %}\n    ## Article {{ loop.index }} | {{ article.date }}\n    **Title:** {{ article.title }}\n    **Source:** {{ article.publisher }}\n    {% if article.full_content %}\n    **Full Content:**\n    {{ article.full_content }}\n    {% elif article.summary %}\n    **Summary:**\n    {{ article.summary }}\n    {% endif %}\n\n    {% endfor %}\n\n    # ANALYSIS FRAMEWORK\n\n    ## Step 1: Identify Cross-Article Patterns\n    Before extracting signals, scan all {{ news | length }} articles to identify:\n    - Recurring themes mentioned in 2+ articles\n    - Consensus vs. divergent viewpoints\n    - Forward-looking statements vs. historical commentary\n    - Data points with specific numbers (GDP, inflation, unemployment, earnings)\n\n    ## Step 2: Extract Structured Signals\n\n    ### 2.1 Dominant Themes (3-5 themes)\n    Extract the most frequently discussed macroeconomic topics across ALL articles.\n    - Format: Concise phrases (4-6 words each)\n    - Examples: \"Fed hawkish tone persists\", \"Soft landing narrative strengthening\", \"Inflation persistence concerns\", \"Labor market cooling signals\"\n    - Prioritize themes that appear in multiple articles\n\n    ### 2.2 Growth Outlook\n    **Sentiment Classification:**\n    - ACCELERATING: GDP growth accelerating, PMI rising, earnings upgrades, expansion momentum\n    - STABLE: Steady growth, moderate GDP (2-3%), flat PMI, stable earnings\n    - SLOWING: Decelerating growth, PMI declining but >50, earnings downgrades, weakening activity\n    - CONTRACTING: Negative growth, PMI <50, recession signals, severe slowdown\n\n    **Summary Requirements:**\n    - 2-3 sentences maximum\n    - Include specific data points (e.g., \"GDP forecast at 2.1%\", \"PMI fell to 48.5\")\n    - Focus on: GDP trends, business activity (PMI), corporate guidance, capex plans\n    - Synthesize across articles - avoid redundancy\n\n    ### 2.3 Inflation Outlook\n    **Sentiment Classification:**\n    - RISING: Inflation accelerating, upside surprises, wage pressure building\n    - STABLE: Inflation steady at current level, contained within target range\n    - FALLING: Disinflation trend, prices declining, deflation risks\n    - ELEVATED: Inflation high but not necessarily rising (e.g., sticky at 4-5%)\n\n    **Summary Requirements:**\n    - 2-3 sentences maximum\n    - Include specific data (CPI, PCE, wage growth percentages)\n    - Focus on: Price pressures, central bank inflation targets, inflation expectations\n    - Note divergence between headline and core if relevant\n\n    ### 2.4 Labor Market\n    **Sentiment Classification:**\n    - STRONG: Unemployment <4%, robust hiring, tight labor market, wage growth >4%\n    - HEALTHY: Balanced market, unemployment 4-5%, moderate hiring, stable wages\n    - SOFTENING: Unemployment rising, hiring slowdown, layoff announcements, quits rate declining\n    - WEAK: High unemployment >6%, mass layoffs, severe hiring freeze\n\n    **Summary Requirements:**\n    - 2-3 sentences maximum\n    - Include specific metrics (unemployment rate, job openings, layoff counts)\n    - Focus on: Employment trends, hiring/firing activity, wage dynamics\n    - Weight company announcements by credibility (major corporations > startups)\n\n    ### 2.5 Central Bank Policy\n    **Stance Classification:**\n    - DOVISH: Signaling rate cuts, accommodative language, prioritizing growth\n    - NEUTRAL: Balanced approach, data-dependent, no clear directional bias\n    - HAWKISH: Prioritizing inflation control, signaling higher-for-longer rates\n    - TIGHTENING: Actively raising rates or reducing balance sheet\n    - EASING: Actively cutting rates or expanding balance sheet\n\n    **Summary Requirements:**\n    - 2-3 sentences maximum\n    - Prioritize official central bank communications over analyst speculation\n    - Include rate expectations (e.g., \"Market pricing 2 cuts by year-end\")\n    - Note any shifts in forward guidance\n\n    ### 2.6 Risk Appetite\n    **Classification:**\n    - RISK_ON: Optimistic tone, rally themes, risk assets favored, bullish sentiment\n    - NEUTRAL: Balanced sentiment, cautious optimism, wait-and-see approach\n    - CAUTIOUS: Defensive positioning emerging, uncertainty rising, volatility concerns\n    - RISK_OFF: Flight to safety, sell-off themes, bearish tone\n    - FEAR: Panic signals, crisis language, extreme risk aversion\n\n    **Assessment Criteria:**\n    - Aggregate sentiment across all articles (not just market commentary)\n    - Consider: Equity market tone, credit market conditions, investor positioning\n    - Weight recent developments more heavily than historical context\n\n    ### 2.7 Regime Narrative\n    **Classification Criteria:**\n    - EARLY_CYCLE: Recovery/rebound themes, stimulus effectiveness, confidence restoration, bottoming signals\n    - MID_CYCLE: Goldilocks/balanced growth, contained inflation, stable conditions, low volatility\n    - LATE_CYCLE: Peak growth warnings, overheating concerns, policy tightening, slowdown anticipation\n    - RECESSION: Contraction language, layoffs, earnings collapses, credit stress, downturn confirmation\n    - UNCERTAIN: Mixed/conflicting signals, transition period, unclear trajectory, divergent views\n\n    **Rationale Requirements:**\n    - 2-3 sentences explaining classification\n    - Reference specific supporting evidence from articles\n    - Acknowledge conflicting signals if present\n\n    ## Step 3: Quality Control Checklist\n    Before finalizing output, verify:\n    - [ ] All summaries are 2-3 sentences (not bullets, not paragraphs)\n    - [ ] Sentiment classifications match the defined criteria above\n    - [ ] Specific numbers included where available (GDP %, inflation %, unemployment %)\n    - [ ] Analysis reflects balance of articles (not cherry-picked)\n    - [ ] Dominant themes appear in multiple articles (not one-off stories)\n    - [ ] Forward-looking information prioritized over historical data\n    - [ ] Credible sources weighted higher (central banks > analysts > pundits)\n\n    # CRITICAL CONSTRAINTS\n\n    1. **Synthesis Over Summarization**: Do NOT list individual article takeaways. Extract the aggregate signal.\n    2. **Conciseness**: Each summary field must be exactly 2-3 sentences. No bullet points, no lists within summaries.\n    3. **Consistency**: Use the exact sentiment/classification options provided. Do not invent new categories.\n    4. **Data-Driven**: Include specific numerical data points whenever available (percentages, basis points, counts).\n    5. **Objectivity**: Reflect the actual balance of sentiment across articles. Avoid confirmation bias.\n    6. **Downstream Context**: This output feeds a business cycle classifier that needs clean, consistent, actionable signals.\n\n    # OUTPUT FORMAT\n\n    {{ ctx.output_format }}\n\n    ---\n\n    Now analyze all {{ news | length }} articles for {{ country }} following the framework above. Think step-by-step through the analysis framework before generating the structured output.\n  \"#\n}",
}

def get_baml_files():
    return _file_map